<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¿Ÿå·å³¶æ—…ç¨‹è¦åŠƒ</title>
    
    <!-- è¼‰å…¥ Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@100..900&family=Noto+Serif+TC:wght@400;700;900&family=Zen+Kaku+Gothic+New:wght@300;400;700&display=swap" rel="stylesheet">
    
    <!-- è¼‰å…¥ Tailwind CSS (å¿…è¦) -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- è¨­å®š Tailwind è‡ªè¨‚é¡è‰²å’Œå­—é«” -->
    <script>
        // è¨­å®š Tailwind é…ç½®
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'custom-base': '#FCFAF2',
                        'custom-primary': '#82663A',
                        'custom-accent': '#B68E55',
                        'custom-light-accent': '#E0DACD',
                        'custom-dark-text': '#5C4E33',
                    },
                    fontFamily: {
                        sans: ['Montserrat', 'sans-serif'],
                        serif: ['Noto Serif TC', 'serif'],
                        content: ['Zen Kaku Gothic New', 'sans-serif'],
                    }
                }
            }
        }
    </script>

    <style>
        /* åŸºç¤å­—é«”è¨­å®š */
        body { 
            font-family: 'Zen Kaku Gothic New', 'Montserrat', sans-serif; 
            color: #82663A; 
            font-weight: 300;
        }
        
        /* é‡å°æ¨™é¡Œ/é‡è¦æ–‡å­—è¦†è“‹å­—é«” */
        .font-serif-title {
            font-family: 'Noto Serif TC', serif;
            font-weight: 700;
        }
        .font-montserrat {
            font-family: 'Montserrat', sans-serif;
        }
        
        /* iok.site é¢¨æ ¼çš„ç·šæ¢åˆ†éš” */
        .info-card {
            border-top: 1px solid #E0DACD; 
            padding-top: 2rem;
        }
        .info-card:first-child {
            border-top: none;
            padding-top: 0;
        }

        /* éš±è—æ»¾å‹•æ¢ */
        .scrollable-planner::-webkit-scrollbar { display: none; }
        .scrollable-planner { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="bg-custom-base min-h-screen">
    <!-- React æ‡‰ç”¨ç¨‹å¼çš„æ ¹å…ƒç´  -->
    <div id="root" class="max-w-5xl mx-auto p-0 sm:p-6 lg:p-8">
        <!-- é€™æ˜¯å”¯ä¸€æœƒåœ¨å•Ÿå‹•å¤±æ•—æ™‚çœ‹åˆ°çš„è¨Šæ¯ -->
        <div class="text-center p-10 font-serif-title text-custom-accent">
            æ­£åœ¨è¼‰å…¥æ ¸å¿ƒå‡½å¼åº«...
        </div>
    </div>
    
    <!-- 1. è¼‰å…¥æ ¸å¿ƒ React å‡½å¼åº« (å¿…é ˆåœ¨ Babel ä¹‹å‰) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- 2. è¼‰å…¥ Babel è½‰æ›å™¨ (å¿…é ˆåœ¨ React ä¹‹å¾Œ) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- 3. React æ‡‰ç”¨ç¨‹å¼é‚è¼¯ (ä½¿ç”¨ type="text/babel") -->
    <script type="text/babel">
        // console.log("1. React/Babel è…³æœ¬å·²è¼‰å…¥ã€‚é–‹å§‹åŸ·è¡Œ JSX ä»£ç¢¼...");

        const { useState, useEffect, useMemo } = React;

        // --- Firebase/API ç›¸é—œè®Šæ•¸ ---
        const apiKey = ""; 
        const GEMINI_API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;

        // --- éœæ…‹é…ç½®èˆ‡è³‡æ–™ ---
        const FLIGHT_IMAGE_TAIPEI_JEJU = "https://placehold.co/600x250/E0DACD/5C4E33?text=å°åŒ—â†’æ¿Ÿå·æ©Ÿç¥¨åœ–ç‰‡";
        const FLIGHT_IMAGE_JEJU_TAIPEI = "https://placehold.co/600x250/E0DACD/5C4E33?text=æ¿Ÿå·â†’å°åŒ—æ©Ÿç¥¨åœ–ç‰‡";

        const CATEGORY_MAP = {
            main: { label: 'ä¸»è¦æ™¯é»è·¯ç·š', icon: 'ğŸ“', color: 'text-custom-accent' },
            food: { label: 'é™„è¿‘ç¾é£Ÿ', icon: 'ğŸœ', color: 'text-orange-500' },
            coffee: { label: 'ç”œé»/å’–å•¡', icon: 'â˜•', color: 'text-indigo-500' },
            alternative: { label: 'å‚™é¸æ™¯é»', icon: 'ğŸ’¡', color: 'text-gray-500' },
            transport: { label: 'äº¤é€š', icon: 'ğŸš—', color: 'text-green-500' },
        };

        const MOCK_DAILY_ITINERARY = [
            // Day 1: 12/04 (Thursday)
            { id: 101, day: 1, date: '12/04 é€±å››', category: 'transport', time: '07:00', location: 'æ¿Ÿå·åœ‹éš›æ©Ÿå ´ â†’ Jeju AutoHouse', notes: "æŠµé”ã€å–è»Šï¼Œæ¥é§è»Šæœå‹™", naverMap: 'https://map.naver.com/p/search/Jeju%20AutoHouse', searchData: null, officialLink: null },
            { id: 102, day: 1, date: '12/04 é€±å››', category: 'main', time: '10:00', location: 'åŸå±±æ—¥å‡ºå³° (Seongsan Ilchulbong)', notes: "ä¸–ç•Œè‡ªç„¶éºç”¢ï¼Œç¶“å…¸æ™¯é»", naverMap: 'https://map.naver.com/p/entry/place/11516281', searchData: null, officialLink: null },
            { id: 103, day: 1, date: '12/04 é€±å››', category: 'food', time: '13:00', location: 'æµ·å¥³ä¹‹å®¶ (Haenyeo House)', notes: "åˆé¤ï¼šæ–°é®®æµ·è†½æ¹¯ã€é®‘é­šç²¥", naverMap: 'https://map.naver.com/p/search/í•´ë…€ì˜ì§‘', searchData: null, officialLink: null },
            { id: 104, day: 1, date: '12/04 é€±å››', category: 'main', time: '15:30', location: 'æ¶‰åœ°å²¬ (Seopjikoji)', notes: "æµ·å²¸ç·šæ­¥é“ã€ç‡ˆå¡”ã€éŸ“åŠ‡å ´æ™¯", naverMap: 'https://map.naver.com/p/entry/place/13361405', searchData: null, officialLink: null },
            { id: 105, day: 1, date: '12/04 é€±å››', category: 'transport', time: '18:00', location: 'ç¬¬ä¸€é–“ä½å®¿ (Aewol Coastal-ro 21104)', notes: "å…¥ä½ï¼Œæº–å‚™æ™šé¤", naverMap: 'https://map.naver.com/p/search/Jeju%20Island%20Jeju-si%20Aewol%20Coastal-ro%2021104', searchData: null, officialLink: null },
            { id: 201, day: 2, date: '12/05 é€±äº”', category: 'main', time: '09:00', location: 'å±±èŒ¶èŠ±ä¹‹ä¸˜ (Camellia Hill)', notes: "è³èŠ±æ‹ç…§è–åœ°ï¼Œ12æœˆæ˜¯å†¬æŸèŠ±å­£", naverMap: 'https://map.naver.com/p/entry/place/13158066', searchData: null, officialLink: 'http://www.camelliahill.co.kr/' },
            { id: 202, day: 2, date: '13:00', category: 'food', time: '13:00', location: 'è¥¿æ­¸æµ¦æ¯æ—¥å¶ä¾†å¸‚å ´', notes: "åˆé¤ï¼šç•¶åœ°å°åƒã€æ©˜å­æœæ±ã€é»‘è±¬è‚‰ä¸²", naverMap: 'https://map.naver.com/p/entry/place/11624534', searchData: null, officialLink: null },
            { id: 203, day: 2, date: '12/05 é€±äº”', category: 'main', time: '16:00', location: 'å¤©å¸æ·µç€‘å¸ƒ', notes: "è¥¿æ­¸æµ¦å€ä¸‰å¤§ç€‘å¸ƒä¹‹ä¸€", naverMap: 'https://map.naver.com/p/entry/place/11624898', searchData: null, officialLink: null },
            { id: 204, day: 2, date: '12/05 é€±äº”', category: 'transport', time: '18:00', location: 'Heyy Seogwipo Hotel', notes: "å…¥ä½ç¬¬äºŒé–“ä½å®¿", naverMap: 'https://map.naver.com/p/entry/place/1639869302', searchData: null, officialLink: null },
            { id: 301, day: 3, date: '12/06 é€±å…­', category: 'main', time: '10:00', location: 'ç¨ç«‹å²© (Oedolgae)', notes: "å­¤ç¨çš„å·¨çŸ³ï¼Œæµ·é‚Šæ¼«æ­¥", naverMap: 'https://map.naver.com/p/entry/place/13444408', searchData: null, officialLink: null },
            { id: 302, day: 3, date: '12/06 é€±å…­', category: 'food', time: '13:00', location: 'æ±é–€å¸‚å ´ (æ™šé¤)', notes: "æ™šä¸Šä¾†é€›ï¼Œå¤œå¸‚ç¾é£Ÿ", naverMap: 'https://map.naver.com/p/entry/place/11620958', searchData: null, officialLink: null },
            { id: 303, day: 3, date: '12/06 é€±å…­', category: 'transport', time: '16:00', location: 'æ¿Ÿå·æ©Ÿå ´-Urbanstay', notes: "å…¥ä½ç¬¬ä¸‰é–“ä½å®¿", naverMap: 'https://naver.me/5S9zc50f', searchData: null, officialLink: null },
            { id: 401, day: 4, date: '12/07 é€±æ—¥', category: 'main', time: '14:00', location: 'æ¶¯æœˆé‚‘ (Aewol)', notes: "å’–å•¡è¡—ã€æµ·é‚Šæ™¯è‰²", naverMap: 'https://map.naver.com/p/search/ì• ì›”ì', searchData: null, officialLink: null },
            { id: 402, day: 4, date: '12/07 é€±æ—¥', category: 'transport', time: '19:00', location: 'Oshare è£å‚™ç§Ÿå€Ÿ', notes: "é ˜å–æ¼¢æ‹å±±ç™»å±±è£å‚™", naverMap: 'https://map.naver.com/p/search/oshare.kr', searchData: null, officialLink: 'https://oshare.kr' },
            { id: 501, day: 5, date: '12/08 é€±ä¸€', category: 'main', time: '07:00', location: 'æ¼¢æ‹å±± (å¾¡é‡Œç‰§ä¸Šï¼Œéˆå®¤ä¸‹)', notes: "æœ¬æ¬¡è¡Œç¨‹é‡é»ï¼šç™»å±±æ´»å‹•", naverMap: 'https://map.naver.com/p/search/í•œë¼ì‚°', searchData: null, officialLink: null },
            { id: 502, day: 5, date: '12/08 é€±ä¸€', category: 'transport', time: '20:00', location: 'Jeju AutoHouse', notes: "é‚„è»Š (æ³¨æ„æ™‚é–“ï¼š20:00å‰)", naverMap: 'https://map.naver.com/p/search/Jeju%20AutoHouse', searchData: null, officialLink: null },
            { id: 503, day: 5, date: '12/08 é€±ä¸€', category: 'transport', time: '22:15', location: 'æ¿Ÿå·åœ‹éš›æ©Ÿå ´ (è¿”ç¨‹)', notes: "é£›æ©Ÿèµ·é£›", naverMap: 'https://map.naver.com/p/search/ì œì£¼êµ­ì œê³µí•­', searchData: null, officialLink: null },
        ];


        // --- æ‹–æ›³æ’åºé‚è¼¯ (DayPlanner å…§éƒ¨ä½¿ç”¨) ---

        const handleDragStart = (e, item) => {
            e.dataTransfer.setData("itemId", item.id);
            setTimeout(() => e.target.classList.add('dragging'), 0);
        };

        const handleDragOver = (e) => {
            e.preventDefault(); 
        };
        
        const handleDragEnd = (e) => {
            e.target.classList.remove('dragging');
        };

        // --- æ ¸å¿ƒçµ„ä»¶ï¼šå–®ä¸€å¡ç‰‡é …ç›® ---
        const ScheduleItem = ({ item, index, isCurrent, onDelete, onSearchGuide, onDropItem }) => {
            const typeInfo = CATEGORY_MAP[item.category] || CATEGORY_MAP.main;
            
            const NaverMapButton = ({ mapUrl }) => (
                <a
                    href={mapUrl}
                    target="_blank"
                    rel="noopener noreferrer"
                    className="flex items-center font-montserrat text-custom-accent hover:text-white text-xs font-semibold transition duration-200 border border-custom-accent/50 rounded-full px-3 py-1 bg-white hover:bg-custom-accent transform hover:scale-[1.03]"
                >
                    {/* Icon: Map Pin */}
                    <svg xmlns="http://www.w3.org/2000/svg" className="h-4 w-4 mr-1" viewBox="0 0 20 20" fill="currentColor">
                        <path fillRule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clipRule="evenodd" />
                    </svg>
                    Naverå°èˆª
                </a>
            );

            const GuideDataDisplay = ({ data }) => {
                if (!data || !data.text) return null;
                
                let text = data.text || "";
                
                return (
                    <div className="mt-4 p-4 bg-gray-50/50 border-t border-custom-light-accent rounded-b-xl">
                        <p className="text-sm font-serif-title text-custom-dark-text mb-2 border-b border-dashed pb-1">
                            {data.title ? `å°éŠåˆ†æ: ${data.title}` : 'å°éŠæ”»ç•¥'}
                        </p>
                        {/* å…§æ–‡ä½¿ç”¨ Zen Kaku Gothic New ç´°é«” */}
                        <p className="text-xs font-content text-gray-700 leading-relaxed font-light" dangerouslySetInnerHTML={{ __html: text }} />
                        {data.uri && (
                            <a href={data.uri} target="_blank" rel="noopener noreferrer" className="text-xs font-montserrat text-custom-accent hover:underline mt-2 block font-medium">
                                ä¾†æºé€£çµ
                            </a>
                        )}
                    </div>
                );
            };

            const currentItemClasses = isCurrent ? "border-l-4 border-l-red-500 bg-red-50/50 shadow-md" : "border-l-4 border-l-custom-light-accent hover:bg-gray-50";


            return (
                <li 
                    key={item.id} 
                    draggable="true" 
                    onDragStart={(e) => handleDragStart(e, item)}
                    onDragOver={handleDragOver}
                    onDrop={(e) => onDropItem(e, item)}
                    onDragEnd={handleDragEnd}
                    className={`cursor-grab p-5 transition duration-150 ${currentItemClasses} border-b border-custom-light-accent`}
                >
                    <div className="flex flex-col sm:flex-row justify-between items-start w-full">
                        <div className="flex-1 min-w-0 pr-4 space-y-2">
                            <div className="flex items-center space-x-3">
                                {/* æ™‚é–“ - Montserrat ç²—é«” */}
                                <span className="text-sm font-montserrat font-bold text-custom-dark-text border-r border-custom-light-accent pr-3">{item.time}</span>
                                {/* é¡åˆ¥æ¨™ç±¤ - Zen Kaku Gothic New ç´°é«” */}
                                <span className={`text-xs font-content font-light px-2 py-0.5 rounded-full ${typeInfo.color} bg-custom-light-accent/50`}>
                                    {/* Icon: Category */}
                                    {typeInfo.icon} {typeInfo.label}
                                </span>
                            </div>
                            {/* åœ°é»åç¨± - Noto Serif TC ç²—é«” */}
                            <h3 className="text-xl font-serif-title text-custom-dark-text leading-tight">
                                {item.location}
                                {isCurrent && <span className="ml-2 text-sm font-montserrat text-red-500">(NOW)</span>}
                            </h3>
                            {item.notes && (
                                {/* å‚™è¨» - Zen Kaku Gothic New ç´°é«” */}
                                <p className="text-sm italic font-content text-gray-700 font-light">
                                    {item.notes}
                                </p>
                            )}
                        </div>

                        <div className="flex flex-wrap space-x-2 mt-4 sm:mt-0 items-center justify-end flex-shrink-0">
                            
                            {/* å°èˆªæŒ‰éˆ• */}
                            {item.naverMap && <NaverMapButton mapUrl={item.naverMap} />}

                            {/* å°éŠæŒ‰éˆ• */}
                            <button
                                onClick={() => onSearchGuide(item.id, item.location)}
                                className={`flex items-center text-xs font-montserrat font-semibold transition duration-200 border rounded-full px-3 py-1 transform hover:scale-[1.03] ${item.searchData ? 'bg-green-100 text-green-700 border-green-400' : 'bg-custom-accent text-white hover:bg-custom-primary'}`}
                                disabled={item.searchData && item.searchData.text && item.searchData.text.includes("è¼‰å…¥ä¸­")}
                            >
                                {/* Icon: Search/Success */}
                                {item.searchData && item.searchData.text && item.searchData.text.includes("è¼‰å…¥ä¸­") ? 'â³ è¼‰å…¥ä¸­' : item.searchData ? 'âœ… æ”»ç•¥' : 'ğŸ” æ”»ç•¥'}
                            </button>
                            
                            {/* åˆªé™¤æŒ‰éˆ• */}
                            <button
                                onClick={() => onDelete(item.id)}
                                className="bg-red-500/10 hover:bg-red-500 text-red-500 hover:text-white text-sm font-medium p-1.5 rounded-full transition duration-150 transform active:scale-95"
                                title="åˆªé™¤é …ç›®"
                            >
                                {/* Icon: Delete */}
                                <svg xmlns="http://www.w3.org/2000/svg" className="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                                    <path fillRule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm4 0a1 1 0 10-2 0v6a1 1 0 102 0V8z" clipRule="evenodd" />
                                </svg>
                            </button>
                        </div>
                    </div>
                    {/* é¡¯ç¤ºå°éŠæœå°‹çµæœ */}
                    <GuideDataDisplay data={item.searchData} />
                    {item.officialLink && (
                        <a href={item.officialLink} target="_blank" rel="noopener noreferrer" className="text-xs font-montserrat text-blue-500 hover:underline mt-2 block font-medium">
                            å®˜æ–¹ç¶²ç«™
                        </a>
                    )}
                </li>
            );
        };


        // --- æ ¸å¿ƒçµ„ä»¶ï¼šå–®æ—¥è¡Œç¨‹åˆ—è¡¨ (å¯æ‹–æ›³æ’åº) ---
        const DayPlanner = ({ day, dayItems, onUpdateOrder, onDelete, onSearchGuide, onDeleteItem }) => {
            const handleDrop = (e, targetItem) => {
                e.preventDefault();
                const draggedItemId = parseInt(e.dataTransfer.getData("itemId"));
                
                if (draggedItemId === targetItem.id) return;
                
                const draggedItemIndex = dayItems.findIndex(i => i.id === draggedItemId);
                const targetIndex = dayItems.findIndex(i => i.id === targetItem.id);
                
                if (draggedItemIndex === -1 || targetIndex === -1) return;

                const newItems = [...dayItems];
                const [removed] = newItems.splice(draggedItemIndex, 1);
                newItems.splice(targetIndex, 0, removed);
                
                onUpdateOrder(day, newItems);
            };

            const handleDropOnListEnd = (e) => {
                e.preventDefault();
                // è™•ç†å¾å…¶ä»–å¤©æ•¸æ‹–æ›³åˆ°ç©ºåˆ—è¡¨æˆ–æœ«å°¾
                const draggedItemId = parseInt(e.dataTransfer.getData("itemId"));
                // ç”±æ–¼ MOCK_DAILY_ITINERARY åœ¨é€™å€‹æ²™ç›’ä¸­æ˜¯éœæ…‹çš„ï¼Œæˆ‘å€‘ç”¨å®ƒä¾†æŸ¥æ‰¾æ‹–æ›³çš„é …ç›®
                const draggedItem = MOCK_DAILY_ITINERARY.find(i => i.id === draggedItemId); 

                if (draggedItem && !dayItems.some(i => i.id === draggedItemId)) {
                    // å¦‚æœæ‹–æ›³çš„é …ç›®ä¸åœ¨ç•¶å‰åˆ—è¡¨ä¸­ (å³å¾å¦ä¸€å¤©æ‹–éä¾†)
                    const newItems = [...dayItems, {...draggedItem, day: day}];
                    // é€™è£¡éœ€è¦å…¨åŸŸçš„ setItinerary é‚è¼¯ä¾†è™•ç†è·¨å¤©çš„ç§»å‹•ï¼Œä½†ç‚ºäº†ä¿æŒ DayPlanner çš„ç´”ç²¹æ€§ï¼Œæˆ‘å€‘åªè™•ç†æ’åºã€‚
                    // è·¨æ—¥æ‹–æ›³é‚è¼¯åœ¨é€™è£¡è¢«ç°¡åŒ–ï¼Œå› ç‚º DayPlanner å‡è¨­å®ƒåªç®¡ç†ç•¶å¤©çš„åˆ—è¡¨ã€‚
                    // æ­£ç¢ºçš„å¯¦ä½œæ‡‰è©²æ˜¯ï¼šåœ¨ App å…§éƒ¨è™•ç†æ‹–æ›³ï¼Œä¸¦æ›´æ–°å…¨åŸŸ stateã€‚
                    // ç‚ºäº†ä½¿æ’åºæ‹–æ›³åœ¨åŒä¸€å¤©å…§ç”Ÿæ•ˆï¼Œæ­¤è™•ä¿ç•™ onUpdateOrderã€‚
                } else if (dayItems.length === 0) {
                    // è™•ç†æ‹–æ›³åˆ°ç©ºåˆ—è¡¨æ™‚çš„è¦–è¦ºæ•ˆæœï¼Œä½†å¯¦éš›ç§»å‹•ç”±å¤–éƒ¨ App è™•ç†
                }
            };


            return (
                <div className="bg-white border border-custom-light-accent rounded-xl shadow-lg overflow-hidden transition-all duration-300 hover:shadow-xl">
                    {/* å¤©æ•¸æ¨™é¡Œ - Noto Serif TC ç²—é«” */}
                    <div className="bg-custom-light-accent/50 text-custom-dark-text p-4 border-b border-custom-accent/50 flex justify-between items-center">
                        <h3 className="text-2xl font-serif-title flex items-center tracking-wider">
                            {/* Day Number - Montserrat ç²—é«” */}
                            <span className="text-3xl font-montserrat font-extrabold mr-3 text-custom-accent">Day {day}</span> 
                            {/* Date - Zen Kaku Gothic New ç´°é«” */}
                            {dayItems.length > 0 && <span className="text-lg font-content font-light opacity-80">{dayItems[0].date}</span>}
                        </h3>
                    </div>
                    
                    {/* è¡Œç¨‹åˆ—è¡¨ */}
                    <ul className="divide-y divide-custom-light-accent">
                        {dayItems.map((item, index) => (
                            <ScheduleItem 
                                key={item.id} 
                                item={item} 
                                index={index}
                                isCurrent={false}
                                onDelete={onDeleteItem} 
                                onSearchGuide={onSearchGuide}
                                onDropItem={handleDrop}
                            />
                        ))}
                         {/* è™•ç†ç©ºåˆ—è¡¨æ‹–æ›³ç›®æ¨™ */}
                        {dayItems.length === 0 && (
                            <li 
                                onDragOver={handleDragOver}
                                onDrop={handleDropOnListEnd}
                                className="p-10 text-center text-gray-400 italic bg-gray-50/50"
                            >
                                å°‡è¡Œç¨‹é …ç›®æ‹–æ›³åˆ°æ­¤è™•...
                            </li>
                        )}
                    </ul>
                </div>
            );
        };
        
        // --- Tab 1: é‡è¦è³‡è¨Š (KeyInfoTab) ---
        const KeyInfoTab = ({ FLIGHT_IMAGE_TAIPEI_JEJU, FLIGHT_IMAGE_JEJU_TAIPEI }) => {
            
            const InfoCard = ({ title, children, icon }) => (
                <div className="info-card p-6 border-b-2 border-custom-light-accent/50">
                    {/* æ¨™é¡Œ - Noto Serif TC ç²—é«” */}
                    <h4 className="text-2xl font-serif-title text-custom-dark-text mb-4 border-l-4 border-custom-accent pl-3 flex items-center">
                        {/* Icon: Section */}
                        <span className="mr-2 text-2xl">{icon}</span>{title}
                    </h4>
                    {/* å…§æ–‡å€å¡Š - Zen Kaku Gothic New ç´°é«” */}
                    <div className="text-base font-content font-light leading-relaxed space-y-4">{children}</div>
                </div>
            );

            const DetailBlock = ({ label, value, type = 'text', link = null }) => (
                <div className="flex flex-col sm:flex-row justify-between items-start pt-3 border-t border-gray-100/50">
                    {/* Label - Zen Kaku Gothic New ç´°é«” */}
                    <span className="font-content font-light text-custom-primary/70 sm:w-1/3 mb-1 sm:mb-0">{label}</span>
                    {/* Value - Montserrat (for dates/numbers) or Zen Kaku Gothic New ç´°é«” */}
                    <span className={`text-custom-dark-text font-bold text-left sm:text-right w-full sm:w-2/3 ${type === 'date' ? 'text-lg font-montserrat' : 'text-base font-content'}`}>
                        {link ? (
                            <a href={link} target="_blank" rel="noopener noreferrer" className="text-custom-accent hover:underline">
                                {value}
                            </a>
                        ) : (
                            value
                        )}
                    </span>
                </div>
            );
            
            return (
                <div className="bg-white rounded-2xl shadow-xl overflow-hidden mb-10">
                    {/* ä¸»æ¨™é¡Œ - Noto Serif TC æ¥µç²— */}
                    <h2 className="text-4xl font-serif-title font-extrabold text-custom-dark-text p-6 border-b border-custom-accent/50">âœˆï¸ é‡è¦è³‡è¨Šä¸€è¦½</h2>
                    
                    {/* 1. èˆªç­æ©Ÿç¥¨ */}
                    <InfoCard title="èˆªç­æ©Ÿç¥¨" icon="ğŸ«">
                        <div className="flex flex-col md:flex-row gap-4">
                            <img src={FLIGHT_IMAGE_TAIPEI_JEJU} alt="å°åŒ—åˆ°æ¿Ÿå·æ©Ÿç¥¨" className="w-full md:w-1/2 rounded-lg object-cover shadow-sm border border-custom-light-accent" />
                            <img src={FLIGHT_IMAGE_JEJU_TAIPEI} alt="æ¿Ÿå·åˆ°å°åŒ—æ©Ÿç¥¨" className="w-full md:w-1/2 rounded-lg object-cover shadow-sm border border-custom-light-accent" />
                        </div>
                        
                        <div className="mt-6 space-y-2 p-3 border border-custom-accent/30 rounded-lg bg-custom-light-accent/10">
                            <h5 className="font-serif-title text-lg text-custom-accent font-bold mb-2">å»ç¨‹ (Outbound)</h5>
                            <DetailBlock label="æ—¥æœŸ" value="12 æœˆ 4 æ—¥ é€±å››" type="date" />
                            <DetailBlock label="æ™‚é–“" value="02:50 - 06:05" />
                            <DetailBlock label="é£›è¡Œæ™‚é–“" value="2 å°æ™‚ 15 åˆ†" />
                        </div>
                        <div className="space-y-2 p-3 border border-custom-accent/30 rounded-lg bg-custom-light-accent/10">
                            <h5 className="font-serif-title text-lg text-custom-accent font-bold mb-2">å›ç¨‹ (Return)</h5>
                            <DetailBlock label="æ—¥æœŸ" value="12 æœˆ 8 æ—¥ é€±ä¸€" type="date" />
                            <DetailBlock label="æ™‚é–“" value="22:15 - 23:50" />
                            <DetailBlock label="é£›è¡Œæ™‚é–“" value="2 å°æ™‚ 35 åˆ†" />
                        </div>
                    </InfoCard>

                    {/* 2. ä½å®¿ */}
                    <InfoCard title="ä½å®¿è³‡è¨Š" icon="ğŸ¨">
                        
                        {/* ä½å®¿ 1 */}
                        <div className="p-4 bg-custom-light-accent/30 rounded-lg border-l-4 border-custom-accent/70">
                            <h5 className="font-serif-title font-bold text-lg text-custom-dark-text mb-3">ç¬¬ä¸€é–“ä½å®¿</h5>
                            <DetailBlock label="å…¥ä½ / é€€æˆ¿" value="12 æœˆ 4 æ—¥ - 12 æœˆ 5 æ—¥" type="date" />
                            <DetailBlock label="åœ°å€" value="Aewol Coastal-ro 21104" />
                        </div>

                        {/* ä½å®¿ 2 */}
                        <div className="p-4 bg-custom-light-accent/30 rounded-lg border-l-4 border-custom-accent/70">
                            <h5 className="font-serif-title font-bold text-lg text-custom-dark-text mb-3">ç¬¬äºŒé–“ä½å®¿ (Heyy Seogwipo Hotel)</h5>
                            <DetailBlock label="å…¥ä½ / é€€æˆ¿" value="12 æœˆ 5 æ—¥ - 12 æœˆ 6 æ—¥" type="date" />
                            <DetailBlock label="å°èˆªé€£çµ" value="Naveråœ°åœ–é€£çµ" link="https://map.naver.com/p/entry/place/1639869302?c=17.61,0,0,0,dh&placePath=/home?from=map&fromPanelNum=1&additionalHeight=76&timestamp=202511262236&locale=ko&svcName=map_pcv5&businessCategory=hotel" />
                        </div>

                        {/* ä½å®¿ 3 */}
                        <div className="p-4 bg-custom-light-accent/30 rounded-lg border-l-4 border-custom-accent/70">
                            <h5 className="font-serif-title font-bold text-lg text-custom-dark-text mb-3">ç¬¬ä¸‰é–“ä½å®¿ (æ¿Ÿå·æ©Ÿå ´-Urbanstay)</h5>
                            <DetailBlock label="å…¥ä½ / é€€æˆ¿" value="12 æœˆ 6 æ—¥ - 12 æœˆ 8 æ—¥ (2æ™š)" type="date" />
                            <DetailBlock label="å°èˆªé€£çµ" value="Naveråœ°åœ–é€£çµ" link="https://naver.me/5S9zc50f" />
                        </div>
                    </InfoCard>

                    {/* 3. å–è»Šè³‡è¨Š */}
                    <InfoCard title="å–è»Š/é‚„è»Šè³‡è¨Š" icon="ğŸš—">
                        <DetailBlock label="è¨‚å–®ç·¨è™Ÿ" value="1359039416311386" type="text" />
                        <DetailBlock label="ç§Ÿå€ŸæœŸé–“" value="12/4 07:00 è‡³ 12/8 20:00 (å…±äº”å¤©)" />
                        <DetailBlock label="åœ°é»" value="Jeju AutoHouse" link="https://map.naver.com/p/search/Jeju%20AutoHouse" />
                        <DetailBlock label="äº¤é€šæ–¹å¼" value="æœ‰æ¥é§è»Š" />
                    </InfoCard>

                    {/* 4. å¿…å¸¶ç‰©å“ (æ¸…å–®) */}
                    <InfoCard title="å¿…å¸¶ç‰©å“æ¸…å–®" icon="ğŸ’">
                        <div className="grid grid-cols-2 md:grid-cols-3 gap-y-3">
                            {['è­·ç…§', 'å°ç£é§•ç…§', 'åœ‹éš›é§•ç…§', 'å°å¹£', 'ä¿¡ç”¨å¡(å»ºè­°å…©å¼µ)', 'è½‰æ¥é ­', 'æ‰‹æ©Ÿ', 'æ›æ´—è¡£ç‰©', 'æ‹–é‹', 'å¸ƒé‹', 'ç›¥æ´—ç”¨å“(ç‰™åˆ·ç‰™è†)', 'å¸¸å‚™è—¥', 'é›¨å…·', '3Cç”¨å“', 'ç”Ÿç†ç”¨å“'].map((item, index) => (
                                <div key={index} className="flex items-center text-custom-dark-text font-content font-light">
                                    <span className="text-custom-accent mr-2 text-lg">â€º</span> {item}
                                </div>
                            ))}
                        </div>
                    </InfoCard>
                    
                    {/* 5. ç©¿æ­æŒ‡å— */}
                    <InfoCard title="å†¬å­£ç©¿æ­æŒ‡å—" icon="ğŸ§¥">
                        <p className="font-content font-medium text-custom-dark-text">æº«åº¦é ä¼°: 5Â°C - 13Â°C (æµ·é¢¨å¼·å‹)</p>
                        <p className="text-custom-accent font-content font-bold border-l-2 border-custom-accent pl-2 mt-2">åŸå‰‡ï¼šæ´‹è”¥å¼ç©¿æ³•ï¼ˆé˜²é¢¨ã€ä¿æš–ã€æ˜“ç©¿è„«ï¼‰</p>
                        <ul className="list-none space-y-2 mt-4">
                            <li className="font-content">
                                <span className="font-bold text-custom-dark-text">å¤–å±¤ (é˜²é¢¨æ˜¯é—œéµ)ï¼š</span> é˜²é¢¨åšå¤–å¥—æˆ–é•·ç‰ˆç¾½çµ¨è¡£ã€‚
                            </li>
                            <li className="font-content">
                                <span className="font-bold text-custom-dark-text">å…§å±¤ï¼š</span> ç™¼ç†±è¡£ã€ä¿æš–å…§è¡£å¿…å‚™ã€‚
                            </li>
                            <li className="font-content">
                                <span className="font-bold text-custom-dark-text">é…ä»¶ (é‡è¦)ï¼š</span> æ¯›å¸½ï¼ˆé˜²é¢¨å¹é ­ç—›ï¼‰ã€åœå·¾ã€æ‰‹å¥—ã€‚
                            </li>
                        </ul>
                    </InfoCard>
                </div>
            );
        };

        // --- Tab 3: çˆ¬å±±è³‡è¨Š (HikingInfoTab) ---
        const HikingInfoTab = () => {
            const DetailBlock = ({ label, value, icon }) => (
                <div className="flex items-center space-x-2 p-3 bg-custom-base/50 rounded-lg border border-custom-light-accent/50">
                    {/* Icon: Detail */}
                    <span className="text-xl text-custom-accent">{icon}</span>
                    <p className="text-base font-content font-light">
                        <span className="font-medium text-custom-primary/70 mr-1">{label}:</span>
                        <span className="font-bold text-custom-dark-text">{value}</span>
                    </p>
                </div>
            );

            const PointList = ({ title, items, colorClass }) => (
                <div className="mt-8">
                    {/* æ¨™é¡Œ - Noto Serif TC ç²—é«” */}
                    <h5 className={`text-xl font-serif-title font-bold ${colorClass} mb-4 border-l-4 border-current pl-3`}>{title}</h5>
                    <ul className="list-none space-y-2 ml-2 text-base font-content font-light text-gray-700">
                        {items.map((item, index) => (
                            <li key={index} className="leading-relaxed flex items-start">
                                <span className="text-custom-accent mr-2 text-lg">ãƒ»</span>
                                <span>
                                    <span className="font-bold text-custom-dark-text">{item.split('ï¼š')[0]}ï¼š</span>
                                    {item.split('ï¼š').slice(1).join('ï¼š')}
                                </span>
                            </li>
                        ))}
                    </ul>
                </div>
            );

            return (
                <div className="bg-white rounded-2xl shadow-xl overflow-hidden p-6 mb-10">
                    {/* ä¸»æ¨™é¡Œ - Noto Serif TC æ¥µç²— */}
                    <h2 className="text-4xl font-serif-title font-extrabold text-custom-dark-text border-b border-custom-accent/50 pb-3 mb-6">ğŸ”ï¸ æ¼¢æ‹å±±ç™»å±±æ”»ç•¥</h2>
                    
                    {/* è£å‚™ç§Ÿå€Ÿ */}
                    <div className="p-4 bg-custom-light-accent/30 rounded-xl mb-8 shadow-inner border border-custom-accent/30">
                        <h4 className="text-xl font-serif-title text-custom-dark-text mb-4 flex items-center border-b border-custom-accent/50 pb-2">
                            {/* Icon: Gear */}
                            <span className="mr-2 text-2xl">ğŸ¿</span> è£å‚™ç§Ÿå€Ÿ (Oshare)
                        </h4>
                        <div className="space-y-3">
                            <DetailBlock label="åº—å®¶ç¶²ç«™" icon="ğŸŒ" value={<a href="https://oshare.kr" target="_blank" rel="noopener noreferrer" className="text-custom-accent hover:underline font-bold font-montserrat">oshare.kr</a>} />
                            <DetailBlock label="å€Ÿç”¨æ™‚é–“" icon="â°" value="12/7 19:00 - 12/8 19:00" />
                        </div>
                    </div>

                    {/* è·¯ç·šèˆ‡åŸºæœ¬è³‡è¨Š */}
                    <div className="p-4 bg-custom-light-accent/30 rounded-xl mb-8 shadow-inner border border-custom-accent/30">
                        <h4 className="text-xl font-serif-title text-custom-dark-text mb-4 border-b border-custom-accent/50 pb-2">â„¹ï¸ è·¯ç·šæ¦‚è¦èˆ‡é è¨ˆæ™‚ç¨‹</h4>
                        <div className="space-y-3">
                            <DetailBlock label="è·¯ç·š" icon="â¡ï¸" value="å¾¡é‡Œç‰§ä¸Š (ì–´ë¦¬ëª©) éˆå®¤ä¸‹ (ì˜ì‹¤) - éç™»é ‚è·¯ç·š" />
                            <DetailBlock label="ç¸½è·é›¢" icon="ğŸ“" value="ç´„ 12.6 KM" />
                            <DetailBlock label="é è¨ˆè€—æ™‚" icon="â±ï¸" value="5.5 ~ 6 å°æ™‚" />
                            <DetailBlock label="å±±ä¸Šæ°£æº«" icon="ğŸ¥¶" value="0Â°C è‡³ -10Â°C (é«”æ„Ÿæ›´ä½)" />
                        </div>
                    </div>
                    
                    {/* ç©¿æ­æ³¨æ„äº‹é … */}
                    <PointList
                        title="âš ï¸ çˆ¬å±±ç©¿æ­æ³¨æ„äº‹é … (æ´‹è”¥å¼ç©¿æ­)"
                        colorClass="text-custom-accent"
                        items={[
                            "é ­éƒ¨ï¼šæ¯›å¸½ï¼ˆå¿…å‚™ï¼‰ã€åœè„–ï¼ˆæ¯”åœå·¾å¥½ç”¨ï¼Œä¸æœƒè¢«é¢¨å¹æ•£ï¼‰ã€‚",
                            "å…§å±¤ï¼šæ’æ±—è¡£/ç™¼ç†±è¡£ï¼ˆçµ•å°ä¸è¦ç©¿æ£‰è³ªï¼Œæµæ±—æ¿•äº†æœƒå¤±æº«ï¼‰ã€‚",
                            "ä¸­å±¤ï¼šåˆ·æ¯›è¡£ (Fleece) æˆ–è¼•è–„ç¾½çµ¨èƒŒå¿ƒã€‚",
                            "å¤–å±¤ï¼šé˜²é¢¨é˜²æ°´å¤–å¥— (ç¡¬æ®¼)ï¼Œé€™å±¤æœ€é‡è¦ã€‚",
                            "ä¸‹èº«ï¼šå…§åˆ·æ¯›çš„é˜²é¢¨ç™»å±±è¤²ï¼Œæˆ–é‹å‹•ç·Šèº«è¤² + çŸ­è¤²ã€‚",
                            "é‹å­ï¼šé«˜ç­’é˜²æ°´ç™»å±±é‹æœ€ä½³ï¼ˆä¿è­·è…³è¸ï¼‰ï¼Œæ­é…ç§Ÿå€Ÿå†°çˆªã€‚",
                            "å‚™ç”¨ï¼šèƒŒåŒ…è£¡å¤šæ”¾ä¸€ä»¶åšç¾½çµ¨å¤–å¥—ï¼Œä¼‘æ¯æ™‚ç©¿ã€‚",
                        ]}
                    />

                    {/* è£œçµ¦å“ */}
                    <PointList
                        title="ğŸ è£œçµ¦å“å»ºè­° (ç•¶åœ°è³¼è²·)"
                        colorClass="text-red-500"
                        items={[
                            "é£²ç”¨æ°´ï¼šè‡³å°‘ 1.5 - 2 å…¬å‡ã€‚",
                            "é£Ÿç‰©ï¼šèƒ½é‡æ£’ (é«˜ç†±é‡é£Ÿç‰©)ã€é›»è§£è³ªé‹å‹•é£²æ–™ã€é£¯æ²ã€éºµåŒ…ç­‰ã€‚",
                            "æ³¨æ„ï¼šè·¯ä¸Šé¿é›£æ‰€æ²’æœ‰æä¾›é¤é£Ÿï¼Œå¿…é ˆè‡ªå‚™ï¼",
                        ]}
                    />

                </div>
            );
        };


        // --- æ ¸å¿ƒçµ„ä»¶ï¼šApp ---
        const App = () => {
            const [itinerary, setItinerary] = useState(MOCK_DAILY_ITINERARY);
            const [newLocation, setNewLocation] = useState('');
            const [newDay, setNewDay] = useState(Math.max(1, ...MOCK_DAILY_ITINERARY.map(i => i.day)));
            const [newNotes, setNewNotes] = useState('');
            const [newCategory, setNewCategory] = useState('main');
            const [nextId, setNextId] = useState(Math.max(...MOCK_DAILY_ITINERARY.map(i => i.id)) + 1 || 1);
            const [currentTab, setCurrentTab] = useState('info'); 
            const [liveTime, setLiveTime] = useState(new Date());

            // ç‚ºäº†æ’é™¤å•é¡Œï¼Œæˆ‘å€‘å°‡å®šæ™‚å™¨ç°¡åŒ–åˆ°åªåœ¨ç¬¬ä¸€æ¬¡æ¸²æŸ“æ™‚ç²å–æ™‚é–“
            useEffect(() => {
                // å¦‚æœéœ€è¦å³æ™‚æ™‚é–“ï¼Œé€™è£¡æ‡‰è©²æœ‰ setIntervalã€‚
                // ç‚ºäº†æ’é™¤éŒ¯èª¤ï¼Œæˆ‘å€‘æš«æ™‚ç¦ç”¨å³æ™‚æ›´æ–°ï¼Œåªåœ¨ mount æ™‚ç²å–ä¸€æ¬¡æ™‚é–“
                setLiveTime(new Date());
            }, []);
            
            // æ™‚é–“ä½¿ç”¨ Montserrat å­—é«”
            const formattedTime = liveTime.toLocaleTimeString('zh-TW', { hour: '2-digit', minute: '2-digit' });
            const weather = { location: "æ¿Ÿå·å¸‚", temp: "18Â°C", conditions: "å¤šé›²/é¢¨å¼·", advice: "ä»Šæ—¥æµ·é‚Šé¢¨å¤§ï¼Œå»ºè­°ç©¿è‘—é˜²é¢¨å¤–å¥—ã€‚" };


            // --- è¡Œç¨‹æ“ä½œé‚è¼¯ ---
            
            // æ’åºå™¨ï¼šæŒ‰å¤©æ•¸æ’åºï¼Œå¦‚æœå¤©æ•¸ç›¸åŒï¼Œå‰‡æŒ‰æ™‚é–“æ’åº
            const sortItinerary = (items) => items.sort((a, b) => {
                if (a.day !== b.day) return a.day - b.day;
                // å‡è¨­æ™‚é–“æ ¼å¼ç‚º HH:MM
                return a.time.localeCompare(b.time);
            });


            const handleAddItem = (e) => {
                e.preventDefault();
                if (!newLocation.trim()) return;

                const newItem = {
                    id: nextId,
                    day: parseInt(newDay),
                    date: `12/${String(newDay).padStart(2, '0')}`, // ç°¡æ˜“æ—¥æœŸè™•ç†
                    category: newCategory,
                    time: new Date().toLocaleTimeString('zh-TW', { hour: '2-digit', minute: '2-digit', hour12: false }), // ä½¿ç”¨ç•¶å‰æ™‚é–“ä½œç‚ºé è¨­
                    location: newLocation.trim(),
                    notes: newNotes.trim(),
                    naverMap: `https://map.naver.com/p/search/${encodeURIComponent(newLocation.trim())}`,
                    searchData: null,
                    officialLink: null,
                };
                
                setItinerary(sortItinerary([...itinerary, newItem]));
                setNextId(nextId + 1);
                
                // é‡ç½®è¡¨å–®
                setNewLocation('');
                setNewNotes('');
                setNewDay(Math.max(1, ...itinerary.map(i => i.day)));
                setNewCategory('main');
            };

            const handleDeleteItem = (id) => {
                setItinerary(itinerary.filter(item => item.id !== id));
            };

            const handleUpdateOrder = (day, newDayItems) => {
                const otherItems = itinerary.filter(item => item.day !== day);
                const updatedItems = [...otherItems, ...newDayItems];
                setItinerary(sortItinerary(updatedItems));
            };
            
            // --- å°éŠæœå°‹åŠŸèƒ½ (ä¸²æ¥ Google Search Tool) ---

            const handleSearchGuide = async (itemId, location) => {
                const userQuery = `æ¿Ÿå·å³¶ ${location} æ™¯é»æ”»ç•¥ æ¨è–¦èœå–®æˆ–éŠç©è³‡è¨Š å®˜æ–¹ç¶²ç«™`;
                
                try {
                    // 1. è¨­ç½®è¼‰å…¥ç‹€æ…‹
                    setItinerary(prev => prev.map(item => 
                        item.id === itemId ? { ...item, searchData: { text: "ğŸ” æ­£åœ¨æœå°‹æ”»ç•¥ä¸­...", title: "è¼‰å…¥ä¸­" } } : item
                    ));
                    
                    const payload = {
                        contents: [{ parts: [{ text: userQuery }] }],
                        tools: [{ "google_search": {} }],
                    };

                    const response = await fetch(GEMINI_API_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                    
                    const result = await response.json();
                    const candidate = result.candidates?.[0];
                    let fetchedText = "æœªèƒ½æ‰¾åˆ°æœ‰æ•ˆæ”»ç•¥ã€‚";
                    let fetchedTitle = "ç„¡æ•ˆçµæœ";
                    let fetchedUri = null;

                    if (candidate && candidate.content?.parts?.[0]?.text) {
                        fetchedText = candidate.content.parts[0].text;
                        
                        const groundingMetadata = candidate.groundingMetadata;
                        if (groundingMetadata && groundingMetadata.groundingAttributions && groundingMetadata.groundingAttributions.length > 0) {
                            fetchedTitle = groundingMetadata.groundingAttributions[0].web?.title || 'æœå°‹çµæœ';
                            fetchedUri = groundingMetadata.groundingAttributions[0].web?.uri || null;
                        }
                    }
                    
                    // 2. æ›´æ–° state
                    setItinerary(prev => prev.map(item => 
                        item.id === itemId ? { ...item, searchData: { text: fetchedText, title: fetchedTitle, uri: fetchedUri } } : item
                    ));

                } catch (error) {
                    console.error("Guide Search Error:", error);
                    setItinerary(prev => prev.map(item => 
                        item.id === itemId ? { ...item, searchData: { text: "âŒ æœå°‹å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²çµ¡æˆ– API è¨­å®šã€‚", title: "éŒ¯èª¤" } } : item
                    ));
                }
            };

            // --- ä»‹é¢æ¸²æŸ“é‚è¼¯ ---

            const groupedItinerary = useMemo(() => itinerary.reduce((acc, item) => {
                (acc[item.day] = acc[item.day] || []).push(item);
                acc[item.day].sort((a, b) => a.time.localeCompare(b.time));
                return acc;
            }, {}), [itinerary]);

            const days = Object.keys(groupedItinerary).map(Number).sort((a, b) => a - b);
            
            const TabButton = ({ name, label, icon }) => (
                <button
                    className={`flex items-center justify-center flex-1 px-4 py-3 font-serif-title text-base sm:text-lg font-bold transition-all focus:outline-none ${
                        currentTab === name
                            ? 'bg-custom-base text-custom-primary border-b-4 border-custom-accent shadow-inner'
                            : 'text-gray-500 hover:text-custom-primary/80 bg-custom-light-accent/30'
                    }`}
                    onClick={() => setCurrentTab(name)}
                >
                    {/* Icon: Tab */}
                    <span className="mr-2 text-xl">{icon}</span> {label}
                </button>
            );


            return (
                <div className="bg-custom-base min-h-screen">
                    
                    {/* é ‚éƒ¨è³‡è¨Šå€å¡Š - Montserrat æ•¸å­—èˆ‡ Zen Kaku Gothic New å…§æ–‡ */}
                    <div className="sticky top-0 z-10 bg-white shadow-xl p-4 mb-8 rounded-b-2xl border-b-4 border-custom-accent/30">
                        <div className="flex justify-between items-center max-w-5xl mx-auto">
                            {/* ä¸»æ¨™é¡Œ - Noto Serif TC æ¥µç²— */}
                            <h1 className="text-3xl font-serif-title font-extrabold text-custom-dark-text tracking-widest flex items-center">
                                {/* Icon: Palm Tree */}
                                <span role="img" aria-label="Palm Tree" className="text-3xl mr-3 opacity-80">ğŸŒ´</span> æ¿Ÿå·æ—…ç¨‹
                            </h1>
                            <div className="text-right text-custom-primary">
                                {/* æ™‚é–“ - Montserrat æ¥µç²— */}
                                <p className="text-2xl font-montserrat font-extrabold text-custom-accent">{formattedTime}</p>
                                {/* å¤©æ°£ - Zen Kaku Gothic New ç´°é«” */}
                                <p className="text-sm font-content font-light">{weather.location}: {weather.temp} | {weather.conditions}</p>
                            </div>
                        </div>
                        <p className="text-center text-sm font-content font-light text-custom-primary mt-3 italic border-t border-gray-200 pt-2">{weather.advice}</p>
                    </div>

                    <div className="max-w-5xl mx-auto p-4 sm:p-0">
                        
                        {/* Tab æŒ‰éˆ• - Noto Serif TC ç²—é«” */}
                        <div className="flex border-b-4 border-custom-light-accent mb-8 bg-custom-light-accent/50 rounded-t-xl overflow-hidden shadow-md">
                            <TabButton name="info" label="é‡è¦è³‡è¨Š" icon="âœˆï¸" />
                            <TabButton name="daily" label="æ¯æ—¥è¡Œç¨‹" icon="ğŸ—ºï¸" />
                            <TabButton name="hiking" label="çˆ¬å±±è³‡è¨Š" icon="ğŸ”ï¸" />
                        </div>

                        {currentTab === 'info' && <KeyInfoTab FLIGHT_IMAGE_TAIPEI_JEJU={FLIGHT_IMAGE_TAIPEI_JEJU} FLIGHT_IMAGE_JEJU_TAIPEI={FLIGHT_IMAGE_JEJU_TAIPEI} />}
                        
                        {currentTab === 'hiking' && <HikingInfoTab />}

                        {currentTab === 'daily' && (
                            <div className="space-y-10">
                                
                                {/* 1. æ–°å¢è¡Œç¨‹è¡¨å–® (éš±è—/å±•é–‹å¼) */}
                                <div className="border-2 border-custom-accent p-6 rounded-2xl bg-white shadow-xl">
                                    <details>
                                        {/* Summary - Noto Serif TC ç²—é«” */}
                                        <summary className="text-2xl font-serif-title font-bold text-custom-dark-text cursor-pointer pb-2 flex items-center">
                                            {/* Icon: Plus */}
                                            <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6 mr-2 text-custom-accent" viewBox="0 0 20 20" fill="currentColor">
                                                <path fillRule="evenodd" d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z" clipRule="evenodd" />
                                            </svg>
                                            å¿«é€Ÿæ–°å¢é …ç›®
                                        </summary>
                                        <form onSubmit={handleAddItem} className="space-y-4 pt-4 border-t border-dashed border-gray-200 mt-2">
                                            <div className="grid grid-cols-1 sm:grid-cols-10 gap-4">
                                                
                                                <label className="flex flex-col sm:col-span-2">
                                                    {/* Label - Zen Kaku Gothic New ç´°é«” */}
                                                    <span className="text-sm font-content font-light text-custom-primary mb-1">å¤©æ•¸ (Day)</span>
                                                    {/* Input - Montserrat */}
                                                    <input
                                                        type="number"
                                                        min="1"
                                                        value={newDay}
                                                        onChange={(e) => setNewDay(e.target.value)}
                                                        required
                                                        className="p-3 border border-gray-300 rounded-lg focus:ring-custom-accent focus:border-custom-accent transition duration-150 bg-custom-base font-montserrat"
                                                    />
                                                </label>

                                                <label className="flex flex-col sm:col-span-3">
                                                    {/* Label - Zen Kaku Gothic New ç´°é«” */}
                                                    <span className="text-sm font-content font-light text-custom-primary mb-1">é¡åˆ¥</span>
                                                    {/* Select - Zen Kaku Gothic New ç´°é«” */}
                                                    <select
                                                        value={newCategory}
                                                        onChange={(e) => setNewCategory(e.target.value)}
                                                        className="p-3 border border-gray-300 rounded-lg focus:ring-custom-accent focus:border-custom-accent transition duration-150 bg-custom-base font-content font-light"
                                                        required
                                                    >
                                                        {Object.keys(CATEGORY_MAP).map(key => (
                                                            <option key={key} value={key}>{CATEGORY_MAP[key].icon} {CATEGORY_MAP[key].label}</option>
                                                        ))}
                                                    </select>
                                                </label>

                                                <label className="flex flex-col sm:col-span-5">
                                                    {/* Label - Zen Kaku Gothic New ç´°é«” */}
                                                    <span className="text-sm font-content font-light text-custom-primary mb-1">åœ°é»åç¨± (å¿…å¡«)</span>
                                                    {/* Input - Zen Kaku Gothic New ç´°é«” */}
                                                    <input
                                                        type="text"
                                                        value={newLocation}
                                                        onChange={(e) => setNewLocation(e.target.value)}
                                                        placeholder="ä¾‹å¦‚ï¼šç‰›å³¶ã€æ¼¢æ‹å±±..."
                                                        required
                                                        className="p-3 border border-gray-300 rounded-lg focus:ring-custom-accent focus:border-custom-accent transition duration-150 bg-custom-base font-content font-light"
                                                    />
                                                </label>
                                            </div>
                                            <label className="flex flex-col">
                                                {/* Label - Zen Kaku Gothic New ç´°é«” */}
                                                <span className="text-sm font-content font-light text-custom-primary mb-1">å‚™è¨»/æ´»å‹• (é¸å¡«)</span>
                                                {/* Input - Zen Kaku Gothic New ç´°é«” */}
                                                <input
                                                    type="text"
                                                    value={newNotes}
                                                    onChange={(e) => setNewNotes(e.target.value)}
                                                    placeholder="ä¾‹å¦‚ï¼šç§Ÿæ©Ÿè»Šç’°å³¶ã€åˆé¤åƒé»‘è±¬è‚‰"
                                                    className="w-full p-3 border border-gray-300 rounded-lg focus:ring-custom-accent focus:border-custom-accent transition duration-150 bg-custom-base font-content font-light"
                                                />
                                            </label>
                                            <button
                                                type="submit"
                                                className="w-full bg-custom-accent hover:bg-custom-primary text-white font-montserrat font-bold py-3 px-4 rounded-xl transition duration-200 shadow-lg hover:shadow-xl transform hover:scale-[1.01] active:scale-[0.99] focus:outline-none focus:ring-4 focus:ring-custom-accent/50"
                                            >
                                                {/* Icon: Plus */}
                                                <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5 inline-block mr-1" viewBox="0 0 20 20" fill="currentColor">
                                                    <path fillRule="evenodd" d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z" clipRule="evenodd" />
                                                </svg>
                                                åŠ å…¥è¡Œç¨‹ (ADD)
                                            </button>
                                        </form>
                                    </details>
                                </div>
                                
                                {/* 2. è¡Œç¨‹é¡¯ç¤ºå€åŸŸ */}
                                <div className="space-y-10 scrollable-planner">
                                    {/* å€å¡Šæ¨™é¡Œ - Noto Serif TC ç²—é«” */}
                                    <h2 className="text-3xl font-serif-title font-bold text-custom-dark-text border-b border-custom-accent/30 pb-3 flex items-center">
                                        {/* Icon: Map Pin */}
                                        <span role="img" aria-label="Map Pin" className="text-xl mr-2 opacity-70">ğŸ—ºï¸</span> å®Œæ•´è¡Œç¨‹ç´°ç¯€ ({days.length} å¤©)
                                    </h2>
                                    
                                    {days.length === 0 ? (
                                        <p className="text-custom-primary/70 italic p-6 bg-white rounded-xl text-center shadow-inner font-content">ç›®å‰æ²’æœ‰ä»»ä½•è¡Œç¨‹ï¼Œè«‹åœ¨ä¸Šæ–¹æ–°å¢é …ç›®ã€‚</p>
                                    ) : (
                                        days.map(day => (
                                            <DayPlanner 
                                                key={day} 
                                                day={day} 
                                                dayItems={groupedItinerary[day]} 
                                                onUpdateOrder={handleUpdateOrder}
                                                onSearchGuide={handleSearchGuide}
                                                onDeleteItem={handleDeleteItem}
                                            />
                                        ))
                                    )}
                                </div>
                            </div>
                        )}
                        
                    </div>
                    
                    {/* æ‡¸æµ®æ–°å¢æŒ‰éˆ• (å³ä¸‹è§’ +) */}
                    {currentTab === 'daily' && (
                        <button
                            className="fixed bottom-6 right-6 bg-custom-accent hover:bg-custom-primary text-white p-4 rounded-full shadow-2xl transition duration-300 transform hover:scale-110 active:scale-90 focus:outline-none focus:ring-4 focus:ring-custom-accent/70"
                            onClick={() => {
                                window.scrollTo({ top: 0, behavior: 'smooth' });
                            }}
                            title="æ–°å¢è¡Œç¨‹"
                        >
                            {/* Icon: Plus */}
                            <svg xmlns="http://www.w3.org/2000/svg" className="h-8 w-8" viewBox="0 0 20 20" fill="currentColor">
                                <path fillRule="evenodd" d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z" clipRule="evenodd" />
                            </svg>
                        </button>
                    )}
                </div>
            );
        };
        
        // æ¸²æŸ“ App å…ƒä»¶åˆ°é é¢
        // ç¢ºä¿åœ¨æ•´å€‹ DOM å…§å®¹è¼‰å…¥å¾Œæ‰å˜—è©¦æ¸²æŸ“
        document.addEventListener('DOMContentLoaded', () => {
            try {
                const container = document.getElementById('root');
                if (container) {
                    // æˆåŠŸæ‰¾åˆ°æ ¹å…ƒç´ ï¼Œæ¸…é™¤è¼‰å…¥è¨Šæ¯
                    container.innerHTML = ''; 
                    const root = ReactDOM.createRoot(container);
                    root.render(React.createElement(App, null));
                } else {
                    console.error("Fatal Error: Root element '#root' not found.");
                    document.body.innerHTML = '<div class="text-center p-10 text-red-600 font-serif-title">è‡´å‘½éŒ¯èª¤ï¼šç„¡æ³•æ‰¾åˆ°æ‡‰ç”¨ç¨‹å¼æ ¹å…ƒç´ ã€‚</div>';
                }
            } catch (e) {
                console.error("Fatal Rendering Error:", e);
                const container = document.getElementById('root');
                if (container) {
                    container.innerHTML = `<div class="text-center p-10 text-red-600 font-serif-title">
                        æ‡‰ç”¨ç¨‹å¼å•Ÿå‹•å¤±æ•—ï¼šè«‹æŸ¥çœ‹ä¸»æ§å°éŒ¯èª¤è¨Šæ¯ã€‚
                        <p class="text-sm mt-2">${e.message}</p>
                    </div>`;
                }
            }
        });

    </script>
</body>
</html>
