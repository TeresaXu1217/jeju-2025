<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¿Ÿå·å³¶æ—…ç¨‹è¦åŠƒ</title>
    <!-- è¼‰å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* ç¢ºä¿å­—é«”å’ŒåŸºæœ¬é¡¯ç¤º */
        body { font-family: 'Inter', sans-serif; }
        /* éš±è—æ‹–æ›³æ™‚çš„ç€è¦½å™¨é è¨­åœ–ç‰‡ */
        .dragging { opacity: 0.5; }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <!-- React æ‡‰ç”¨ç¨‹å¼çš„æ ¹å…ƒç´  -->
    <div id="root" class="max-w-5xl mx-auto p-0 sm:p-6 lg:p-8">
        <!-- æ‡‰ç”¨ç¨‹å¼å°‡æœƒæ¸²æŸ“åœ¨é€™è£¡ -->
    </div>
    
    <!-- è¼‰å…¥æ‰€æœ‰è…³æœ¬å’Œé‚è¼¯ -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- React æ‡‰ç”¨ç¨‹å¼é‚è¼¯ (JSX å¯«åœ¨ <script> æ¨™ç±¤å…§) -->
    <script type="text/babel">
        const { useState, useEffect, useCallback, useMemo } = React;

        // --- Firebase/API ç›¸é—œè®Šæ•¸ (ç¢ºä¿åœ¨ Canvas ç’°å¢ƒä¸­é‹è¡Œ) ---
        const apiKey = ""; 
        const GEMINI_API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;

        // --- éœæ…‹é…ç½®èˆ‡è¼”åŠ©å‡½å¼ ---

        const STATUS_OPTIONS = [
            { value: 'pending', label: 'æœªé–‹å§‹', color: 'bg-amber-100 text-amber-800 border-amber-300' },
            { value: 'in_progress', label: 'é€²è¡Œä¸­', color: 'bg-blue-100 text-blue-700 border-blue-300' },
            { value: 'completed', label: 'å·²å®Œæˆ', color: 'bg-green-100 text-green-700 border-green-300' },
        ];
        
        const TYPE_OPTIONS = {
            sight: { label: 'æ™¯é»', icon: 'â›°ï¸', color: 'border-blue-500 bg-blue-50' },
            food: { label: 'é¤å»³/ç¾é£Ÿ', icon: 'ğŸ½ï¸', color: 'border-red-500 bg-red-50' },
            transport: { label: 'äº¤é€š/ä½å®¿', icon: 'âœˆï¸', color: 'border-gray-500 bg-gray-50' },
        };

        const initialItinerary = [
            { id: 1, day: 1, type: 'transport', location: "æ¿Ÿå·åœ‹éš›æ©Ÿå ´ (Jeju International Airport)", notes: "ç§Ÿè»Šï¼Œå‰å¾€æ¿Ÿå·å¸‚å€é…’åº—", status: 'completed', searchData: null },
            { id: 2, day: 1, type: 'food', location: "æ±é–€å¸‚å ´", notes: "å“åšé»‘è±¬è‚‰ä¸²å’Œç•¶åœ°å°åƒ", status: 'in_progress', searchData: null },
            { id: 3, day: 2, type: 'sight', location: "åŸå±±æ—¥å‡ºå³°", notes: "æ¸…æ™¨çˆ¬å±±è§€æ—¥å‡º", status: 'pending', searchData: null },
            { id: 4, day: 2, type: 'sight', location: "æ¶‰åœ°å²¬ (Seopjikoji)", notes: "æµ·å²¸æ•£æ­¥èˆ‡ç‡ˆå¡”", status: 'pending', searchData: null },
        ];

        // --- æ‹–æ›³æ’åºé‚è¼¯ (DayPlanner å…§éƒ¨ä½¿ç”¨) ---

        const handleDragStart = (e, item) => {
            e.dataTransfer.setData("itemId", item.id);
            // è®“æ‹–æ›³å…ƒç´ çœ‹èµ·ä¾†åŠé€æ˜
            setTimeout(() => e.target.classList.add('dragging'), 0);
        };

        const handleDragOver = (e) => {
            e.preventDefault(); // å…è¨±æ”¾ä¸‹
        };
        
        const handleDragEnd = (e) => {
            e.target.classList.remove('dragging');
        };

        // --- æ ¸å¿ƒçµ„ä»¶ï¼šå–®æ—¥è¡Œç¨‹åˆ—è¡¨ ---
        const DayPlanner = ({ day, dayItems, onUpdateOrder, onDelete, onStatusChange, onSearchGuide }) => {
            const handleDrop = (e, targetItem) => {
                e.preventDefault();
                e.target.classList.remove('dragging-over');

                const draggedItemId = parseInt(e.dataTransfer.getData("itemId"));
                const draggedItem = dayItems.find(item => item.id === draggedItemId);
                
                if (!draggedItem || draggedItem.id === targetItem.id) return;
                
                // é‡æ–°æ’åº
                const newItems = dayItems.filter(item => item.id !== draggedItemId);
                const targetIndex = newItems.findIndex(item => item.id === targetItem.id);
                
                // æ’å…¥è¢«æ‹–æ›³çš„é …ç›®
                newItems.splice(targetIndex, 0, draggedItem);
                
                onUpdateOrder(day, newItems);
            };

            const NaverMapButton = ({ location }) => (
                <a
                    href={`https://map.naver.com/p/search/${location}`}
                    target="_blank"
                    rel="noopener noreferrer"
                    className="bg-green-500 hover:bg-green-600 text-white text-xs font-bold py-1 px-2 rounded-lg transition duration-200 shadow-sm flex items-center transform hover:scale-[1.05]"
                >
                    <svg xmlns="http://www.w3.org/2000/svg" className="h-4 w-4 mr-1" viewBox="0 0 20 20" fill="currentColor">
                        <path fillRule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clipRule="evenodd" />
                    </svg>
                    å°èˆª
                </a>
            );

            const GuideDataDisplay = ({ data }) => {
                if (!data) return null;
                
                // æ¨¡æ“¬é—œéµå­—äº®é¡¯ (å¿…åƒç¾é£Ÿã€å¿…è²·ä¼´æ‰‹ç¦®ç­‰)
                let text = data.text || "";
                const highlights = ["å¿…åƒç¾é£Ÿ", "å¿…é»èœå–®", "å¿…è²·ä¼´æ‰‹ç¦®", "é‡è¦é ç´„ä»£è™Ÿ", "ç‡Ÿæ¥­æ™‚é–“", "äº¤é€šæ–¹å¼"];

                highlights.forEach(keyword => {
                    const regex = new RegExp(`(${keyword})`, 'g');
                    // ä½¿ç”¨ <b class="text-red-600 bg-red-100 p-0.5 rounded"> ä¾†äº®é¡¯é—œéµå­—
                    text = text.replace(regex, `<b class="text-red-600 bg-red-100 p-0.5 rounded">${keyword}</b>`);
                });

                return (
                    <div className="mt-3 p-3 bg-indigo-50 border-l-4 border-indigo-400 rounded-b-lg">
                        <p className="text-sm font-semibold text-indigo-700 mb-1">å°éŠåˆ†æï¼š{data.title}</p>
                        {/* ä½¿ç”¨ dangerouslySetInnerHTML æ¸²æŸ“å¸¶æœ‰äº®é¡¯çš„æ–‡å­— */}
                        <p className="text-xs text-indigo-600 leading-relaxed" dangerouslySetInnerHTML={{ __html: text }} />
                        {data.uri && (
                            <a href={data.uri} target="_blank" rel="noopener noreferrer" className="text-xs text-indigo-500 hover:underline mt-1 block">
                                ä¾†æºé€£çµ
                            </a>
                        )}
                    </div>
                );
            };

            return (
                <div className="bg-white border-2 border-gray-300 rounded-2xl shadow-xl overflow-hidden">
                    {/* å¤©æ•¸æ¨™é¡Œ - ä½¿ç”¨æ·±è—è‰²æ¼¸å±¤ */}
                    <div className="bg-gradient-to-r from-blue-700 to-blue-600 text-white p-4 flex justify-between items-center">
                        <h3 className="text-2xl font-black flex items-center">
                            <span role="img" aria-label="Sun" className="text-2xl mr-2">â˜€ï¸</span> ç¬¬ {day} å¤© (Day {day})
                        </h3>
                        <span className="text-sm opacity-90">{dayItems.length} å€‹æ™¯é»</span>
                    </div>
                    
                    {/* è¡Œç¨‹åˆ—è¡¨ */}
                    <ul className="divide-y divide-gray-200">
                        {dayItems.map((item, index) => {
                            const statusInfo = STATUS_OPTIONS.find(s => s.value === item.status) || STATUS_OPTIONS[0];
                            const typeInfo = TYPE_OPTIONS[item.type] || TYPE_OPTIONS.sight;
                            const isCompleted = item.status === 'completed';

                            return (
                                <li 
                                    key={item.id} 
                                    draggable="true" // å•Ÿç”¨æ‹–æ›³
                                    onDragStart={(e) => handleDragStart(e, item)}
                                    onDragOver={handleDragOver}
                                    onDrop={(e) => handleDrop(e, item)}
                                    onDragEnd={handleDragEnd}
                                    // æŒ‰å£“ 0.2 ç§’æµ®å‹•æ‹–æ›³æ•ˆæœç”± CSS çš„ dragging class è™•ç†
                                    className={`cursor-grab p-4 transition duration-150 ${typeInfo.color} border-l-4 ${isCompleted ? 'bg-opacity-50 line-through' : 'hover:bg-gray-50 bg-opacity-100'}`}
                                >
                                    <div className="flex flex-col sm:flex-row justify-between items-start sm:items-center w-full">
                                        
                                        <div className="flex-1 min-w-0 pr-4 space-y-1">
                                            <div className="flex items-center space-x-3">
                                                {/* æ™¯é»åç¨± */}
                                                <span className="text-lg font-black text-gray-800 flex items-center">
                                                    {typeInfo.icon} {item.location}
                                                </span>
                                                
                                                {/* ç‹€æ…‹æ¨™ç±¤ */}
                                                <span className={`px-2 py-0.5 text-xs font-bold rounded-full border ${statusInfo.color} flex-shrink-0`}>
                                                    {statusInfo.label}
                                                </span>
                                            </div>
                                            {item.notes && (
                                                <p className="text-sm text-gray-600 italic pl-1">å‚™è¨»ï¼š{item.notes}</p>
                                            )}
                                        </div>

                                        <div className="flex flex-wrap space-x-2 mt-3 sm:mt-0 items-center justify-end">
                                            
                                            {/* å°éŠæŒ‰éˆ• */}
                                            <button
                                                onClick={() => onSearchGuide(item.id, item.location)}
                                                className={`bg-indigo-500 hover:bg-indigo-600 text-white text-xs font-bold py-1 px-2 rounded-lg transition duration-200 shadow-sm flex items-center transform hover:scale-[1.05] ${item.searchData ? 'opacity-50' : ''}`}
                                                disabled={item.searchData}
                                            >
                                                {item.searchData ? 'âœ… æ”»ç•¥å·²è¼‰å…¥' : 'ğŸ” å°éŠæ”»ç•¥'}
                                            </button>

                                            {/* å°èˆªæŒ‰éˆ• */}
                                            <NaverMapButton location={item.location} />
                                            
                                            {/* ç‹€æ…‹åˆ‡æ›ä¸‹æ‹‰é¸å–® */}
                                            <select
                                                value={item.status}
                                                onChange={(e) => onStatusChange(item.id, e.target.value)}
                                                className="text-sm py-1.5 px-3 border border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500"
                                            >
                                                {STATUS_OPTIONS.map(option => (
                                                    <option key={option.value} value={option.value}>
                                                        {option.label}
                                                    </option>
                                                ))}
                                            </select>
                                            
                                            {/* åˆªé™¤æŒ‰éˆ• */}
                                            <button
                                                onClick={() => onDelete(item.id)}
                                                className="bg-red-500 hover:bg-red-600 text-white text-sm font-medium py-1.5 px-3 rounded-lg transition duration-150 shadow-md focus:outline-none focus:ring-4 focus:ring-red-300 transform active:scale-95"
                                            >
                                                ğŸ—‘ï¸
                                            </button>
                                        </div>
                                    </div>
                                    {/* é¡¯ç¤ºå°éŠæœå°‹çµæœ */}
                                    <GuideDataDisplay data={item.searchData} />
                                </li>
                            );
                        })}
                    </ul>
                </div>
            );
        };

        // --- æ ¸å¿ƒçµ„ä»¶ï¼šApp ---
        const App = () => {
            const [itinerary, setItinerary] = useState(initialItinerary);
            const [newLocation, setNewLocation] = useState('');
            const [newDay, setNewDay] = useState(Math.max(1, ...initialItinerary.map(i => i.day)));
            const [newNotes, setNewNotes] = useState('');
            const [newType, setNewType] = useState('sight');
            const [nextId, setNextId] = useState(initialItinerary.length + 1);
            const [currentTab, setCurrentTab] = useState('itinerary');
            const [liveTime, setLiveTime] = useState(new Date());

            // --- å³æ™‚æ™‚é–“èˆ‡æ¨¡æ“¬å¤©æ°£ ---
            useEffect(() => {
                const timer = setInterval(() => setLiveTime(new Date()), 1000);
                return () => clearInterval(timer);
            }, []);

            const formattedTime = liveTime.toLocaleTimeString('zh-TW', { hour: '2-digit', minute: '2-digit' });
            
            // æ¨¡æ“¬å¤©æ°£å’Œå»ºè­° (éœ€æ›¿æ›ç‚ºçœŸå¯¦ API)
            const weather = { location: "æ¿Ÿå·å¸‚", temp: "18Â°C", conditions: "å¤šé›²", advice: "å»ºè­°æ”œå¸¶è¼•ä¾¿å¤–å¥—å’Œå¤ªé™½çœ¼é¡ã€‚" };

            // --- è¡Œç¨‹æ“ä½œé‚è¼¯ ---

            const handleAddItem = (e) => {
                e.preventDefault();
                if (!newLocation.trim()) return;

                const newItem = {
                    id: nextId,
                    day: parseInt(newDay),
                    type: newType,
                    location: newLocation.trim(),
                    notes: newNotes.trim(),
                    status: 'pending',
                    searchData: null
                };
                
                setItinerary([...itinerary, newItem].sort((a, b) => a.day - b.day));
                setNextId(nextId + 1);
                
                setNewLocation('');
                setNewNotes('');
                setNewDay(Math.max(1, ...itinerary.map(i => i.day)));
                setNewType('sight');
            };

            const handleDeleteItem = (id) => {
                setItinerary(itinerary.filter(item => item.id !== id));
            };

            const handleStatusChange = (id, newStatus) => {
                setItinerary(itinerary.map(item => 
                    item.id === id ? { ...item, status: newStatus } : item
                ));
            };

            const handleUpdateOrder = (day, newDayItems) => {
                const otherItems = itinerary.filter(item => item.day !== day);
                setItinerary([...otherItems, ...newDayItems].sort((a, b) => a.day - b.day));
            };
            
            // --- å°éŠæœå°‹åŠŸèƒ½ (ä¸²æ¥ Google Search Tool) ---

            const handleSearchGuide = async (itemId, location) => {
                const userQuery = `æ¿Ÿå·å³¶ ${location} æ™¯é»æ”»ç•¥ å¿…åƒç¾é£Ÿ ä¼´æ‰‹ç¦®`;
                
                try {
                    setItinerary(itinerary.map(item => 
                        item.id === itemId ? { ...item, searchData: { text: "ğŸ” æ­£åœ¨æœå°‹æ”»ç•¥ä¸­...", title: "è¼‰å…¥ä¸­" } } : item
                    ));
                    
                    const payload = {
                        contents: [{ parts: [{ text: userQuery }] }],
                        tools: [{ "google_search": {} }],
                    };

                    const response = await fetch(GEMINI_API_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                    
                    const result = await response.json();
                    const candidate = result.candidates?.[0];
                    let fetchedText = "æœªèƒ½æ‰¾åˆ°æœ‰æ•ˆæ”»ç•¥ã€‚";
                    let fetchedTitle = "ç„¡æ•ˆçµæœ";
                    let fetchedUri = null;

                    if (candidate && candidate.content?.parts?.[0]?.text) {
                        fetchedText = candidate.content.parts[0].text;
                        
                        const groundingMetadata = candidate.groundingMetadata;
                        if (groundingMetadata && groundingMetadata.groundingAttributions && groundingMetadata.groundingAttributions.length > 0) {
                            // ä½¿ç”¨ç¬¬ä¸€å€‹ä¾†æºçš„æ¨™é¡Œå’ŒURI
                            fetchedTitle = groundingMetadata.groundingAttributions[0].web?.title || 'æœå°‹çµæœ';
                            fetchedUri = groundingMetadata.groundingAttributions[0].web?.uri || null;
                        }
                    }
                    
                    // æ›´æ–° state
                    setItinerary(itinerary.map(item => 
                        item.id === itemId ? { ...item, searchData: { text: fetchedText, title: fetchedTitle, uri: fetchedUri } } : item
                    ));

                } catch (error) {
                    console.error("Guide Search Error:", error);
                    setItinerary(itinerary.map(item => 
                        item.id === itemId ? { ...item, searchData: { text: "âŒ æœå°‹å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²çµ¡æˆ– API è¨­å®šã€‚", title: "éŒ¯èª¤" } } : item
                    ));
                }
            };

            // --- ä»‹é¢æ¸²æŸ“é‚è¼¯ ---

            const groupedItinerary = itinerary.reduce((acc, item) => {
                (acc[item.day] = acc[item.day] || []).push(item);
                // ç¢ºä¿æ¯å€‹ day å…§çš„ items æ˜¯æ’åºå¥½çš„ (ç”¨æ–¼æ‹–æ›³å¾Œçš„æŒä¹…åŒ–é †åº)
                acc[item.day].sort((a, b) => itinerary.indexOf(a) - itinerary.indexOf(b));
                return acc;
            }, {});

            const days = Object.keys(groupedItinerary).map(Number).sort((a, b) => a - b);
            
            const TabButton = ({ name, label }) => (
                <button
                    className={`px-4 py-2 font-semibold transition-colors rounded-t-lg ${
                        currentTab === name
                            ? 'bg-white text-blue-700 border-b-2 border-blue-700 shadow-md'
                            : 'text-gray-600 hover:text-blue-500 hover:bg-gray-50'
                    }`}
                    onClick={() => setCurrentTab(name)}
                >
                    {label}
                </button>
            );

            const ToolsTab = () => (
                <div className="space-y-6">
                    <h3 className="text-3xl font-bold text-gray-800 border-b pb-2 mb-4">âœˆï¸ æ—…è¡Œå·¥å…·ç®±</h3>
                    
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                        {/* èˆªç­è³‡è¨Šå¡ç‰‡ */}
                        <div className="bg-white p-6 border border-gray-200 rounded-xl shadow-lg hover:shadow-xl transition">
                            <h4 className="text-xl font-bold text-blue-700 mb-3 flex items-center">
                                èˆªç­è³‡è¨Š <span role="img" aria-label="Plane" className="ml-2">ğŸ›«</span>
                            </h4>
                            <textarea
                                className="w-full h-24 p-3 border border-gray-300 rounded-lg text-sm focus:border-blue-500"
                                placeholder="è«‹è¼¸å…¥èˆªç­è™Ÿç¢¼ã€èµ·é™æ™‚é–“ã€èˆªç©ºå…¬å¸..."
                            ></textarea>
                            <button className="mt-3 w-full bg-blue-500 hover:bg-blue-600 text-white font-medium py-2 rounded-lg">å„²å­˜èˆªç­</button>
                        </div>
                        
                        {/* ä½å®¿è³‡è¨Šå¡ç‰‡ */}
                        <div className="bg-white p-6 border border-gray-200 rounded-xl shadow-lg hover:shadow-xl transition">
                            <h4 className="text-xl font-bold text-blue-700 mb-3 flex items-center">
                                ä½å®¿è³‡è¨Š <span role="img" aria-label="Hotel" className="ml-2">ğŸ¨</span>
                            </h4>
                            <textarea
                                className="w-full h-24 p-3 border border-gray-300 rounded-lg text-sm focus:border-blue-500"
                                placeholder="è«‹è¼¸å…¥é…’åº—åç¨±ã€åœ°å€ã€é ç´„è™Ÿç¢¼..."
                            ></textarea>
                            <button className="mt-3 w-full bg-blue-500 hover:bg-blue-600 text-white font-medium py-2 rounded-lg">å„²å­˜ä½å®¿</button>
                        </div>

                        {/* ç·Šæ€¥è¯çµ¡é›»è©±å¡ç‰‡ */}
                        <div className="bg-white p-6 border border-gray-200 rounded-xl shadow-lg hover:shadow-xl transition">
                            <h4 className="text-xl font-bold text-red-700 mb-3 flex items-center">
                                ç·Šæ€¥è¯çµ¡ <span role="img" aria-label="Emergency" className="ml-2">ğŸš¨</span>
                            </h4>
                            <p className="text-sm font-semibold mb-2">æ¿Ÿå·å³¶ç·Šæ€¥é›»è©±ï¼š119</p>
                            <textarea
                                className="w-full h-16 p-3 border border-gray-300 rounded-lg text-sm focus:border-red-500"
                                placeholder="è«‹è¼¸å…¥ä¿éšªå…¬å¸ã€ä¿¡ç”¨å¡å®¢æœé›»è©±..."
                            ></textarea>
                            <button className="mt-3 w-full bg-red-500 hover:bg-red-600 text-white font-medium py-2 rounded-lg">å„²å­˜è¯çµ¡äºº</button>
                        </div>

                        {/* è¨˜å¸³/é ç®—è¡¨å¡ç‰‡ (ç°¡åŒ–ç‰ˆ) */}
                        <div className="bg-white p-6 border border-gray-200 rounded-xl shadow-lg hover:shadow-xl transition">
                            <h4 className="text-xl font-bold text-green-700 mb-3 flex items-center">
                                è¨˜å¸³/é ç®— <span role="img" aria-label="Money" className="ml-2">ğŸ’°</span>
                            </h4>
                            <input type="number" placeholder="é ç®—ç¸½é¡ (KRW)" className="w-full p-2 border border-gray-300 rounded-lg mb-2" />
                            <textarea
                                className="w-full h-16 p-3 border border-gray-300 rounded-lg text-sm focus:border-green-500"
                                placeholder="è¨˜éŒ„æ”¯å‡ºé …ç›®ï¼šäº¤é€š â‚©50,000 / é£Ÿç‰© â‚©25,000..."
                            ></textarea>
                            <button className="mt-3 w-full bg-green-500 hover:bg-green-600 text-white font-medium py-2 rounded-lg">å„²å­˜é ç®—</button>
                        </div>
                    </div>
                </div>
            );


            return (
                <div className="bg-gray-100 min-h-screen">
                    
                    {/* é ‚éƒ¨å°èˆª/æ™‚é–“/å¤©æ°£ */}
                    <div className="sticky top-0 z-10 bg-white shadow-lg p-4 mb-6 rounded-b-2xl">
                        <div className="flex justify-between items-center max-w-5xl mx-auto">
                            <h1 className="text-2xl font-black text-blue-800 flex items-center">
                                <span role="img" aria-label="Palm Tree" className="text-3xl mr-2">ğŸŒ´</span> æ¿Ÿå·æ—…è¡Œè¦åŠƒ
                            </h1>
                            <div className="text-right text-gray-600">
                                <p className="text-xl font-extrabold text-blue-600">{formattedTime}</p>
                                <p className="text-sm">{weather.location}: {weather.temp} | {weather.conditions}</p>
                            </div>
                        </div>
                        <p className="text-center text-sm font-medium text-gray-500 mt-2 italic">{weather.advice}</p>
                    </div>

                    <div className="max-w-5xl mx-auto p-4 sm:p-0">
                        
                        {/* Tab æŒ‰éˆ• */}
                        <div className="flex border-b border-gray-300 mb-6">
                            <TabButton name="itinerary" label="ğŸ“… è¡Œç¨‹è¦åŠƒ" />
                            <TabButton name="tools" label="ğŸ› ï¸ æ—…è¡Œå·¥å…·ç®±" />
                        </div>

                        {currentTab === 'itinerary' && (
                            <div className="space-y-8">
                                
                                {/* 1. æ–°å¢è¡Œç¨‹è¡¨å–® */}
                                <div className="border-2 border-green-400 p-5 rounded-xl bg-white shadow-xl">
                                    <h2 className="text-2xl font-bold text-green-700 mb-4 flex items-center">
                                        <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6 mr-2" viewBox="0 0 20 20" fill="currentColor">
                                            <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-11a1 1 0 10-2 0v2H7a1 1 0 100 2h2v2a1 1 0 102 0v-2h2a1 1 0 100-2h-2V7z" clipRule="evenodd" />
                                        </svg>
                                        å¿«é€Ÿæ–°å¢é …ç›®
                                    </h2>
                                    <form onSubmit={handleAddItem} className="space-y-4">
                                        <div className="grid grid-cols-1 sm:grid-cols-10 gap-4">
                                            
                                            <label className="flex flex-col sm:col-span-1">
                                                <span className="text-sm font-medium text-gray-700 mb-1">å¤©æ•¸</span>
                                                <input
                                                    type="number"
                                                    min="1"
                                                    value={newDay}
                                                    onChange={(e) => setNewDay(e.target.value)}
                                                    required
                                                    className="p-3 border-2 border-gray-300 rounded-lg focus:ring-green-500 focus:border-green-500 transition duration-150"
                                                />
                                            </label>

                                            <label className="flex flex-col sm:col-span-3">
                                                <span className="text-sm font-medium text-gray-700 mb-1">é¡å‹</span>
                                                <select
                                                    value={newType}
                                                    onChange={(e) => setNewType(e.target.value)}
                                                    className="p-3 border-2 border-gray-300 rounded-lg focus:ring-green-500 focus:border-green-500 transition duration-150"
                                                    required
                                                >
                                                    <option value="sight">{TYPE_OPTIONS.sight.icon} {TYPE_OPTIONS.sight.label}</option>
                                                    <option value="food">{TYPE_OPTIONS.food.icon} {TYPE_OPTIONS.food.label}</option>
                                                    <option value="transport">{TYPE_OPTIONS.transport.icon} {TYPE_OPTIONS.transport.label}</option>
                                                </select>
                                            </label>

                                            <label className="flex flex-col sm:col-span-6">
                                                <span className="text-sm font-medium text-gray-700 mb-1">åœ°é»åç¨±</span>
                                                <input
                                                    type="text"
                                                    value={newLocation}
                                                    onChange={(e) => setNewLocation(e.target.value)}
                                                    placeholder="ä¾‹å¦‚ï¼šç‰›å³¶ã€æ¼¢æ‹å±±..."
                                                    required
                                                    className="p-3 border-2 border-gray-300 rounded-lg focus:ring-green-500 focus:border-green-500 transition duration-150"
                                                />
                                            </label>
                                        </div>
                                        <label className="flex flex-col">
                                            <span className="text-sm font-medium text-gray-700 mb-1">å‚™è¨»/æ´»å‹•</span>
                                            <input
                                                type="text"
                                                value={newNotes}
                                                onChange={(e) => setNewNotes(e.target.value)}
                                                placeholder="ä¾‹å¦‚ï¼šç§Ÿæ©Ÿè»Šç’°å³¶ã€åˆé¤åƒé»‘è±¬è‚‰"
                                                className="w-full p-3 border-2 border-gray-300 rounded-lg focus:ring-green-500 focus:border-green-500 transition duration-150"
                                            />
                                        </label>
                                        <button
                                            type="submit"
                                            className="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded-xl transition duration-200 shadow-lg hover:shadow-xl transform hover:scale-[1.01] active:scale-[0.99] focus:outline-none focus:ring-4 focus:ring-green-300"
                                        >
                                            <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5 inline-block mr-1" viewBox="0 0 20 20" fill="currentColor">
                                                <path fillRule="evenodd" d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z" clipRule="evenodd" />
                                            </svg>
                                            åŠ å…¥è¡Œç¨‹
                                        </button>
                                    </form>
                                </div>
                                
                                {/* 2. è¡Œç¨‹é¡¯ç¤ºå€åŸŸ */}
                                <div className="space-y-6">
                                    <h2 className="text-3xl font-black text-gray-800 border-b-2 border-gray-300 pb-2 flex items-center">
                                        <span role="img" aria-label="Map Pin" className="text-xl mr-2">ğŸ“</span> æˆ‘çš„å®Œæ•´è¡Œç¨‹ ({days.length} å¤©)
                                    </h2>
                                    
                                    {days.length === 0 ? (
                                        <p className="text-gray-500 italic p-6 bg-white rounded-xl text-center shadow-inner">ç›®å‰æ²’æœ‰ä»»ä½•è¡Œç¨‹ï¼Œè¶•å¿«è¦åŠƒæ‚¨çš„æ¿Ÿå·å³¶ä¹‹æ—…å§ï¼</p>
                                    ) : (
                                        days.map(day => (
                                            <DayPlanner 
                                                key={day} 
                                                day={day} 
                                                dayItems={groupedItinerary[day]} 
                                                onUpdateOrder={handleUpdateOrder}
                                                onDelete={handleDeleteItem}
                                                onStatusChange={handleStatusChange}
                                                onSearchGuide={handleSearchGuide}
                                            />
                                        ))
                                    )}
                                </div>
                            </div>
                        )}
                        
                        {currentTab === 'tools' && <ToolsTab />}
                    </div>
                    
                    {/* æ‡¸æµ®æ–°å¢æŒ‰éˆ• (å³ä¸‹è§’ +) */}
                    {currentTab === 'itinerary' && (
                        <button
                            className="fixed bottom-6 right-6 bg-blue-600 hover:bg-blue-700 text-white p-4 rounded-full shadow-2xl transition duration-300 transform hover:scale-110 active:scale-90 focus:outline-none focus:ring-4 focus:ring-blue-300"
                            onClick={() => {
                                // æ»¾å‹•åˆ°æ–°å¢è¡¨å–®
                                window.scrollTo({ top: 0, behavior: 'smooth' });
                            }}
                            title="æ–°å¢è¡Œç¨‹"
                        >
                            <svg xmlns="http://www.w3.org/2000/svg" className="h-8 w-8" viewBox="0 0 20 20" fill="currentColor">
                                <path fillRule="evenodd" d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z" clipRule="evenodd" />
                            </svg>
                        </button>
                    )}
                </div>
            );
        };
        
        // æ¸²æŸ“ App å…ƒä»¶åˆ°é é¢
        const container = document.getElementById('root');
        const root = ReactDOM.createRoot(container);
        root.render(React.createElement(App, null));
    </script>
</body>
</html>
