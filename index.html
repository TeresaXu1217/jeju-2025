<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¿Ÿå·å³¶æ—…ç¨‹è¦åŠƒ</title>
    
    <!-- è¼‰å…¥ Google Fonts (ä½¿ç”¨ Noto Serif TC ä»¥ç¢ºä¿ç¹é«”ä¸­æ–‡çš„æœ€ä½³é¡¯ç¤º) -->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@100..900&family=Noto+Serif+TC:wght@700;900&family=Zen+Kaku+Gothic+New:wght@300;400;700&display=swap" rel="stylesheet">
    
    <!-- è¼‰å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- è¨­å®š Tailwind è‡ªè¨‚é¡è‰²å’Œå­—é«” -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'custom-base': '#F9F5F0', // æ·ºç±³ç™½ï¼Œæ›´æŸ”å’Œ
                        'custom-primary': '#6D5B41', // æ·±æ£•è‰²ï¼Œå–ä»£ #82663A
                        'custom-accent': '#C09A67', // äº®æ£•è‰²/é‡‘è‰²ï¼Œæ›´å…·è³ªæ„Ÿ
                        'custom-light-accent': '#EBE4DA', // æ·ºç°ç±³è‰²
                        'custom-dark-text': '#4F4130', // æ¥µæ·±è‰²æ–‡å­—
                    },
                    fontFamily: {
                        sans: ['Montserrat', 'sans-serif'], // è‹±æ–‡/æ•¸å­—
                        serif: ['Noto Serif TC', 'serif'], // ä¸­æ–‡å¤§æ¨™é¡Œ (ç²—é«”)
                        content: ['Zen Kaku Gothic New', 'sans-serif'], // ä¸­æ–‡å…§æ–‡ (ç´°é«”)
                    }
                }
            }
        }
    </script>

    <style>
        /* åŸºç¤å­—é«”è¨­å®šï¼šä½¿ç”¨ Zen Kaku Gothic New ç´°é«” */
        body { 
            font-family: 'Zen Kaku Gothic New', 'Montserrat', sans-serif; 
            color: var(--custom-primary); /* ä½¿ç”¨ CSS è®Šé‡ï¼Œä½† Tailwind æœƒè¦†è“‹ */
            font-weight: 300;
        }
        
        /* Noto Serif TC ç²—é«” */
        .font-serif-title {
            font-family: 'Noto Serif TC', serif;
            font-weight: 900; /* ä½¿ç”¨æ¥µç²—é«” */
        }
        /* Montserrat ç²—é«” */
        .font-montserrat-bold {
            font-family: 'Montserrat', sans-serif;
            font-weight: 700;
        }

        /* éš±è—æ»¾å‹•æ¢ */
        .scrollable-planner::-webkit-scrollbar { display: none; }
        .scrollable-planner { -ms-overflow-style: none; scrollbar-width: none; }

        /* å¢å¼·ç´°ç¯€å¡ç‰‡é™°å½± */
        .card-shadow {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.05), 0 4px 6px -2px rgba(0, 0, 0, 0.03);
        }
    </style>
</head>
<body class="bg-custom-base min-h-screen">
    <!-- React æ‡‰ç”¨ç¨‹å¼çš„æ ¹å…ƒç´  -->
    <div id="root" class="max-w-5xl mx-auto p-0 sm:p-6 lg:p-8">
        <div class="text-center p-10 font-serif-title text-custom-accent">
            æ­£åœ¨è¼‰å…¥æ ¸å¿ƒå‡½å¼åº«...
        </div>
    </div>
    
    <!-- 1. è¼‰å…¥æ ¸å¿ƒ React å‡½å¼åº« -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- 2. è¼‰å…¥ Babel è½‰æ›å™¨ -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- 3. React æ‡‰ç”¨ç¨‹å¼é‚è¼¯ (ä½¿ç”¨ type="text/babel") -->
    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // --- Firebase/API ç›¸é—œè®Šæ•¸ ---
        const apiKey = ""; 
        const GEMINI_API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;

        // --- åœ–ç¤º/åœ–ç‰‡è™•ç† ---
        // ç•¶æ‚¨æä¾›åœ–ç‰‡å¾Œï¼Œè«‹å°‡é€™äº› URL æ›¿æ›ç‚ºå¯¦éš›çš„è·¯å¾‘
        const getIconUrl = (name, size) => {
            const sizeMap = {
                'lg': '48x48', 'md': '24x24', 'sm': '16x16'
            };
            const s = sizeMap[size] || '24x24';
            const color = 'C09A67'; // è¼”è‰²
            const bgColor = 'F9F5F0'; // åŸºç¤è‰²
            return `https://placehold.co/${s}/${bgColor}/${color}?text=${encodeURIComponent(name.toUpperCase())}`;
        };

        const FLIGHT_IMAGE_TAIPEI_JEJU = "https://placehold.co/600x250/EBE4DA/4F4130?text=å°åŒ—â†’æ¿Ÿå·æ©Ÿç¥¨åœ–ç‰‡";
        const FLIGHT_IMAGE_JEJU_TAIPEI = "https://placehold.co/600x250/EBE4DA/4F4130?text=æ¿Ÿå·â†’å°åŒ—æ©Ÿç¥¨åœ–ç‰‡";


        const CATEGORY_MAP = {
            main: { label: 'ä¸»è¦æ™¯é»è·¯ç·š', iconName: 'LOCATION', color: 'text-custom-accent' },
            food: { label: 'é™„è¿‘ç¾é£Ÿ', iconName: 'FOOD', color: 'text-orange-600' },
            coffee: { label: 'ç”œé»/å’–å•¡', iconName: 'COFFEE', color: 'text-indigo-600' },
            alternative: { label: 'å‚™é¸æ™¯é»', iconName: 'ALT', color: 'text-gray-600' },
            transport: { label: 'äº¤é€š', iconName: 'CAR', color: 'text-green-600' },
        };

        const MOCK_DAILY_ITINERARY = [
            // Mock data remains the same...
            { id: 101, day: 1, date: '12/04 é€±å››', category: 'transport', time: '07:00', location: 'æ¿Ÿå·åœ‹éš›æ©Ÿå ´ â†’ Jeju AutoHouse', notes: "æŠµé”ã€å–è»Šï¼Œæ¥é§è»Šæœå‹™", naverMap: 'https://map.naver.com/p/search/Jeju%20AutoHouse', searchData: null, officialLink: null },
            { id: 102, day: 1, date: '12/04 é€±å››', category: 'main', time: '10:00', location: 'åŸå±±æ—¥å‡ºå³° (Seongsan Ilchulbong)', notes: "ä¸–ç•Œè‡ªç„¶éºç”¢ï¼Œç¶“å…¸æ™¯é»", naverMap: 'https://map.naver.com/p/entry/place/11516281', searchData: null, officialLink: null },
            { id: 103, day: 1, date: '12/04 é€±å››', category: 'food', time: '13:00', location: 'æµ·å¥³ä¹‹å®¶ (Haenyeo House)', notes: "åˆé¤ï¼šæ–°é®®æµ·è†½æ¹¯ã€é®‘é­šç²¥", naverMap: 'https://map.naver.com/p/search/í•´ë…€ì˜ì§‘', searchData: null, officialLink: null },
            { id: 104, day: 1, date: '12/04 é€±å››', category: 'main', time: '15:30', location: 'æ¶‰åœ°å²¬ (Seopjikoji)', notes: "æµ·å²¸ç·šæ­¥é“ã€ç‡ˆå¡”ã€éŸ“åŠ‡å ´æ™¯", naverMap: 'https://map.naver.com/p/entry/place/13361405', searchData: null, officialLink: null },
            { id: 105, day: 1, date: '12/04 é€±å››', category: 'transport', time: '18:00', location: 'ç¬¬ä¸€é–“ä½å®¿ (Aewol Coastal-ro 21104)', notes: "å…¥ä½ï¼Œæº–å‚™æ™šé¤", naverMap: 'https://map.naver.com/p/search/Jeju%20Island%20Jeju-si%20Aewol%20Coastal-ro%2021104', searchData: null, officialLink: null },
            { id: 201, day: 2, date: '12/05 é€±äº”', category: 'main', time: '09:00', location: 'å±±èŒ¶èŠ±ä¹‹ä¸˜ (Camellia Hill)', notes: "è³èŠ±æ‹ç…§è–åœ°ï¼Œ12æœˆæ˜¯å†¬æŸèŠ±å­£", naverMap: 'https://map.naver.com/p/entry/place/13158066', searchData: null, officialLink: 'http://www.camelliahill.co.kr/' },
            { id: 202, day: 2, date: '12/05 é€±äº”', category: 'food', time: '13:00', location: 'è¥¿æ­¸æµ¦æ¯æ—¥å¶ä¾†å¸‚å ´', notes: "åˆé¤ï¼šç•¶åœ°å°åƒã€æ©˜å­æœæ±ã€é»‘è±¬è‚‰ä¸²", naverMap: 'https://map.naver.com/p/entry/place/11624534', searchData: null, officialLink: null },
            { id: 203, day: 2, date: '12/05 é€±äº”', category: 'main', time: '16:00', location: 'å¤©å¸æ·µç€‘å¸ƒ', notes: "è¥¿æ­¸æµ¦å€ä¸‰å¤§ç€‘å¸ƒä¹‹ä¸€", naverMap: 'https://map.naver.com/p/entry/place/11624898', searchData: null, officialLink: null },
            { id: 204, day: 2, date: '12/05 é€±äº”', category: 'transport', time: '18:00', location: 'Heyy Seogwipo Hotel', notes: "å…¥ä½ç¬¬äºŒé–“ä½å®¿", naverMap: 'https://map.naver.com/p/entry/place/1639869302', searchData: null, officialLink: null },
            { id: 301, day: 3, date: '12/06 é€±å…­', category: 'main', time: '10:00', location: 'ç¨ç«‹å²© (Oedolgae)', notes: "å­¤ç¨çš„å·¨çŸ³ï¼Œæµ·é‚Šæ¼«æ­¥", naverMap: 'https://map.naver.com/p/entry/place/13444408', searchData: null, officialLink: null },
            { id: 302, day: 3, date: '12/06 é€±å…­', category: 'food', time: '13:00', location: 'æ±é–€å¸‚å ´ (æ™šé¤)', notes: "æ™šä¸Šä¾†é€›ï¼Œå¤œå¸‚ç¾é£Ÿ", naverMap: 'https://map.naver.com/p/entry/place/11620958', searchData: null, officialLink: null },
            { id: 303, day: 3, date: '12/06 é€±å…­', category: 'transport', time: '16:00', location: 'æ¿Ÿå·æ©Ÿå ´-Urbanstay', notes: "å…¥ä½ç¬¬ä¸‰é–“ä½å®¿", naverMap: 'https://naver.me/5S9zc50f', searchData: null, officialLink: null },
            { id: 401, day: 4, date: '12/07 é€±æ—¥', category: 'main', time: '14:00', location: 'æ¶¯æœˆé‚‘ (Aewol)', notes: "å’–å•¡è¡—ã€æµ·é‚Šæ™¯è‰²", naverMap: 'https://map.naver.com/p/search/ì• ì›”ì', searchData: null, officialLink: null },
            { id: 402, day: 4, date: '12/07 é€±æ—¥', category: 'transport', time: '19:00', location: 'Oshare è£å‚™ç§Ÿå€Ÿ', notes: "é ˜å–æ¼¢æ‹å±±ç™»å±±è£å‚™", naverMap: 'https://map.naver.com/p/search/oshare.kr', searchData: null, officialLink: 'https://oshare.kr' },
            { id: 501, day: 5, date: '12/08 é€±ä¸€', category: 'main', time: '07:00', location: 'æ¼¢æ‹å±± (å¾¡é‡Œç‰§ä¸Šï¼Œéˆå®¤ä¸‹)', notes: "æœ¬æ¬¡è¡Œç¨‹é‡é»ï¼šç™»å±±æ´»å‹•", naverMap: 'https://map.naver.com/p/search/í•œë¼ì‚°', searchData: null, officialLink: null },
            { id: 502, day: 5, date: '12/08 é€±ä¸€', category: 'transport', time: '20:00', location: 'Jeju AutoHouse', notes: "é‚„è»Š (æ³¨æ„æ™‚é–“ï¼š20:00å‰)", naverMap: 'https://map.naver.com/p/search/Jeju%20AutoHouse', searchData: null, officialLink: null },
            { id: 503, day: 5, date: '12/08 é€±ä¸€', category: 'transport', time: '22:15', location: 'æ¿Ÿå·åœ‹éš›æ©Ÿå ´ (è¿”ç¨‹)', notes: "é£›æ©Ÿèµ·é£›", naverMap: 'https://map.naver.com/p/search/ì œì£¼êµ­ì œê³µí•­', searchData: null, officialLink: null },
        ];


        // --- æ‹–æ›³æ’åºé‚è¼¯ (DayPlanner å…§éƒ¨ä½¿ç”¨) ---

        const handleDragStart = (e, item) => {
            e.dataTransfer.setData("itemId", item.id);
            setTimeout(() => e.target.classList.add('opacity-40', 'ring-2', 'ring-custom-accent'), 0);
        };

        const handleDragOver = (e) => {
            e.preventDefault(); 
        };
        
        const handleDragEnd = (e) => {
            e.target.classList.remove('opacity-40', 'ring-2', 'ring-custom-accent');
        };

        // --- æ ¸å¿ƒçµ„ä»¶ï¼šå–®ä¸€å¡ç‰‡é …ç›® ---
        const ScheduleItem = ({ item, index, isCurrent, onDelete, onSearchGuide, onDropItem }) => {
            const typeInfo = CATEGORY_MAP[item.category] || CATEGORY_MAP.main;
            
            const NaverMapButton = ({ mapUrl }) => (
                <a
                    href={mapUrl}
                    target="_blank"
                    rel="noopener noreferrer"
                    className="flex items-center font-montserrat-bold text-custom-accent hover:text-white text-xs font-semibold transition duration-200 border border-custom-accent/50 rounded-full px-3 py-1 bg-white hover:bg-custom-accent transform hover:scale-[1.03] shadow-sm"
                >
                    <img src={getIconUrl('MAP', 'sm')} alt="Map Icon" className="h-4 w-4 mr-1 opacity-70" />
                    Naverå°èˆª
                </a>
            );

            const GuideDataDisplay = ({ data }) => {
                if (!data || !data.text) return null;
                
                let text = data.text || "";
                
                return (
                    <div className="mt-4 p-4 bg-custom-light-accent/40 border border-custom-light-accent rounded-b-xl transition duration-300">
                        <p className="text-sm font-serif-title text-custom-dark-text mb-2 border-b border-custom-accent/50 pb-1">
                            {data.title ? `å°éŠåˆ†æ: ${data.title}` : 'å°éŠæ”»ç•¥'}
                        </p>
                        <p className="text-xs font-content text-gray-700 leading-relaxed font-light" dangerouslySetInnerHTML={{ __html: text }} />
                        {data.uri && (
                            <a href={data.uri} target="_blank" rel="noopener noreferrer" className="text-xs font-montserrat-bold text-blue-600 hover:underline mt-2 block font-medium">
                                ä¾†æºé€£çµ
                            </a>
                        )}
                    </div>
                );
            };

            const currentItemClasses = isCurrent ? "border-l-4 border-l-red-500 bg-red-50/50 shadow-md" : "border-l-4 border-l-custom-light-accent hover:bg-custom-base/50";


            return (
                <li 
                    key={item.id} 
                    draggable="true" 
                    onDragStart={(e) => handleDragStart(e, item)}
                    onDragOver={handleDragOver}
                    onDrop={(e) => onDropItem(e, item)}
                    onDragEnd={handleDragEnd}
                    className={`cursor-grab p-5 transition duration-150 ${currentItemClasses} border-b border-custom-light-accent`}
                >
                    <div className="flex flex-col sm:flex-row justify-between items-start w-full">
                        <div className="flex-1 min-w-0 pr-4 space-y-2">
                            <div className="flex items-center space-x-3">
                                {/* æ™‚é–“ - Montserrat ç²—é«” */}
                                <span className="text-sm font-montserrat-bold text-custom-dark-text border-r border-custom-light-accent pr-3">{item.time}</span>
                                {/* é¡åˆ¥æ¨™ç±¤ - Zen Kaku Gothic New ç´°é«” */}
                                <span className={`text-xs font-content font-light px-2 py-0.5 rounded-full ${typeInfo.color} bg-custom-light-accent/50`}>
                                    <img src={getIconUrl(typeInfo.iconName, 'sm')} alt={`${typeInfo.label} Icon`} className="h-4 w-4 inline-block mr-1 opacity-80" />
                                    {typeInfo.label}
                                </span>
                            </div>
                            {/* åœ°é»åç¨± - Noto Serif TC æ¥µç²— */}
                            <h3 className="text-xl font-serif-title text-custom-dark-text leading-tight">
                                {item.location}
                                {isCurrent && <span className="ml-2 text-sm font-montserrat-bold text-red-500">(NOW)</span>}
                            </h3>
                            {item.notes && (
                                {/* å‚™è¨» - Zen Kaku Gothic New ç´°é«” */}
                                <p className="text-sm italic font-content text-gray-700 font-light">
                                    {item.notes}
                                </p>
                            )}
                        </div>

                        <div className="flex flex-wrap space-x-2 mt-4 sm:mt-0 items-center justify-end flex-shrink-0">
                            
                            {/* å°èˆªæŒ‰éˆ• */}
                            {item.naverMap && <NaverMapButton mapUrl={item.naverMap} />}

                            {/* å°éŠæŒ‰éˆ• */}
                            <button
                                onClick={() => onSearchGuide(item.id, item.location)}
                                className={`flex items-center text-xs font-montserrat-bold font-semibold transition duration-200 border rounded-full px-3 py-1 transform hover:scale-[1.03] shadow-sm ${item.searchData ? 'bg-green-100 text-green-700 border-green-400' : 'bg-custom-accent text-white hover:bg-custom-primary'}`}
                                disabled={item.searchData && item.searchData.text && item.searchData.text.includes("è¼‰å…¥ä¸­")}
                            >
                                <img src={getIconUrl(item.searchData ? 'SUCCESS' : 'SEARCH', 'sm')} alt="Search Icon" className="h-4 w-4 mr-1 filter invert" />
                                {item.searchData && item.searchData.text && item.searchData.text.includes("è¼‰å…¥ä¸­") ? 'è¼‰å…¥ä¸­' : item.searchData ? 'å·²ç²å–' : 'æ”»ç•¥'}
                            </button>
                            
                            {/* åˆªé™¤æŒ‰éˆ• */}
                            <button
                                onClick={() => onDelete(item.id)}
                                className="bg-red-500/10 hover:bg-red-500 text-red-500 hover:text-white text-sm font-medium p-2 rounded-full transition duration-150 transform active:scale-95 shadow-sm"
                                title="åˆªé™¤é …ç›®"
                            >
                                <img src={getIconUrl('DELETE', 'sm')} alt="Delete Icon" className="h-4 w-4 filter invert" />
                            </button>
                        </div>
                    </div>
                    {/* é¡¯ç¤ºå°éŠæœå°‹çµæœ */}
                    <GuideDataDisplay data={item.searchData} />
                    {item.officialLink && (
                        <a href={item.officialLink} target="_blank" rel="noopener noreferrer" className="text-xs font-montserrat-bold text-blue-600 hover:underline mt-2 block font-medium">
                            å®˜æ–¹ç¶²ç«™
                        </a>
                    )}
                </li>
            );
        };


        // --- æ ¸å¿ƒçµ„ä»¶ï¼šå–®æ—¥è¡Œç¨‹åˆ—è¡¨ (å¯æ‹–æ›³æ’åº) ---
        const DayPlanner = ({ day, dayItems, onUpdateOrder, onSearchGuide, onDeleteItem }) => {
            const handleDrop = (e, targetItem) => {
                e.preventDefault();
                const draggedItemId = parseInt(e.dataTransfer.getData("itemId"));
                
                if (draggedItemId === targetItem.id) return;
                
                const draggedItemIndex = dayItems.findIndex(i => i.id === draggedItemId);
                const targetIndex = dayItems.findIndex(i => i.id === targetItem.id);
                
                if (draggedItemIndex === -1 || targetIndex === -1) return;

                const newItems = [...dayItems];
                const [removed] = newItems.splice(draggedItemIndex, 1);
                newItems.splice(targetIndex, 0, removed);
                
                onUpdateOrder(day, newItems);
            };

            const handleDropOnListEnd = (e) => {
                e.preventDefault();
                // ç‚ºäº†ç°¡åŒ–ï¼Œè·¨æ—¥æ‹–æ›³åŠŸèƒ½åœ¨æ­¤å–®ä¸€æ–‡ä»¶å¯¦ä½œä¸­è¢«ç²¾ç°¡ã€‚
            };


            return (
                <div className="bg-white border border-custom-light-accent rounded-2xl shadow-xl overflow-hidden transition-all duration-300 card-shadow">
                    {/* å¤©æ•¸æ¨™é¡Œ - Noto Serif TC æ¥µç²— */}
                    <div className="bg-custom-light-accent/70 text-custom-dark-text p-4 border-b border-custom-accent flex justify-between items-center">
                        <h3 className="text-3xl font-serif-title flex items-center tracking-wide">
                            {/* Day Number - Montserrat æ¥µç²— */}
                            <span className="text-4xl font-montserrat-bold mr-3 text-custom-accent">Day {day}</span> 
                            {/* Date - Zen Kaku Gothic New ç´°é«” */}
                            {dayItems.length > 0 && <span className="text-lg font-content font-light opacity-80">{dayItems[0].date}</span>}
                        </h3>
                    </div>
                    
                    {/* è¡Œç¨‹åˆ—è¡¨ */}
                    <ul className="divide-y divide-custom-light-accent/80">
                        {dayItems.map((item, index) => (
                            <ScheduleItem 
                                key={item.id} 
                                item={item} 
                                index={index}
                                isCurrent={false}
                                onDelete={onDeleteItem} 
                                onSearchGuide={onSearchGuide}
                                onDropItem={handleDrop}
                            />
                        ))}
                         {/* è™•ç†ç©ºåˆ—è¡¨æ‹–æ›³ç›®æ¨™ */}
                        {dayItems.length === 0 && (
                            <li 
                                onDragOver={handleDragOver}
                                onDrop={handleDropOnListEnd}
                                className="p-10 text-center text-gray-400 italic bg-gray-50/50"
                            >
                                å°‡è¡Œç¨‹é …ç›®æ‹–æ›³åˆ°æ­¤è™•...
                            </li>
                        )}
                    </ul>
                </div>
            );
        };
        
        // --- Tab 1: é‡è¦è³‡è¨Š (KeyInfoTab) ---
        const KeyInfoTab = ({ FLIGHT_IMAGE_TAIPEI_JEJU, FLIGHT_IMAGE_JEJU_TAIPEI }) => {
            
            const InfoCard = ({ title, children, iconName }) => (
                <div className="info-card p-6 border-b border-custom-light-accent/80">
                    {/* æ¨™é¡Œ - Noto Serif TC æ¥µç²— */}
                    <h4 className="text-2xl font-serif-title text-custom-dark-text mb-4 border-l-4 border-custom-accent pl-3 flex items-center">
                        <img src={getIconUrl(iconName, 'md')} alt={`${title} Icon`} className="h-6 w-6 mr-3 opacity-80" />
                        {title}
                    </h4>
                    {/* å…§æ–‡å€å¡Š - Zen Kaku Gothic New ç´°é«” */}
                    <div className="text-base font-content font-light leading-relaxed space-y-4">{children}</div>
                </div>
            );

            const DetailBlock = ({ label, value, type = 'text', link = null }) => (
                <div className="flex flex-col sm:flex-row justify-between items-start py-3 border-t border-custom-light-accent/50">
                    {/* Label - Zen Kaku Gothic New ç´°é«” */}
                    <span className="font-content font-light text-custom-primary/70 sm:w-1/3 mb-1 sm:mb-0">{label}</span>
                    {/* Value - Montserrat (for dates/numbers) or Zen Kaku Gothic New ç´°é«” */}
                    <span className={`text-custom-dark-text font-bold text-left sm:text-right w-full sm:w-2/3 ${type === 'date' ? 'text-lg font-montserrat-bold' : 'text-base font-content'}`}>
                        {link ? (
                            <a href={link} target="_blank" rel="noopener noreferrer" className="text-custom-accent hover:underline">
                                {value}
                            </a>
                        ) : (
                            value
                        )}
                    </span>
                </div>
            );
            
            return (
                <div className="bg-white rounded-2xl shadow-xl overflow-hidden mb-10 card-shadow">
                    {/* ä¸»æ¨™é¡Œ - Noto Serif TC æ¥µç²— */}
                    <h2 className="text-4xl font-serif-title font-extrabold text-custom-dark-text p-6 border-b border-custom-accent/50">
                        <img src={getIconUrl('INFO', 'lg')} alt="Info Icon" className="h-8 w-8 inline-block mr-3 opacity-80" />
                        é‡è¦è³‡è¨Šä¸€è¦½
                    </h2>
                    
                    {/* 1. èˆªç­æ©Ÿç¥¨ */}
                    <InfoCard title="èˆªç­æ©Ÿç¥¨" iconName="TICKET">
                        <div className="flex flex-col md:flex-row gap-4">
                            <img src={FLIGHT_IMAGE_TAIPEI_JEJU} alt="å°åŒ—åˆ°æ¿Ÿå·æ©Ÿç¥¨" className="w-full md:w-1/2 rounded-lg object-cover shadow-sm border border-custom-light-accent" />
                            <img src={FLIGHT_IMAGE_JEJU_TAIPEI} alt="æ¿Ÿå·åˆ°å°åŒ—æ©Ÿç¥¨" className="w-full md:w-1/2 rounded-lg object-cover shadow-sm border border-custom-light-accent" />
                        </div>
                        
                        <div className="mt-6 space-y-2 p-4 border border-custom-accent/50 rounded-lg bg-custom-light-accent/30">
                            <h5 className="font-serif-title text-xl text-custom-accent font-bold mb-2">å»ç¨‹ (Outbound)</h5>
                            <DetailBlock label="æ—¥æœŸ" value="12 æœˆ 4 æ—¥ é€±å››" type="date" />
                            <DetailBlock label="æ™‚é–“" value="02:50 - 06:05" />
                            <DetailBlock label="é£›è¡Œæ™‚é–“" value="2 å°æ™‚ 15 åˆ†" />
                        </div>
                        <div className="space-y-2 p-4 border border-custom-accent/50 rounded-lg bg-custom-light-accent/30">
                            <h5 className="font-serif-title text-xl text-custom-accent font-bold mb-2">å›ç¨‹ (Return)</h5>
                            <DetailBlock label="æ—¥æœŸ" value="12 æœˆ 8 æ—¥ é€±ä¸€" type="date" />
                            <DetailBlock label="æ™‚é–“" value="22:15 - 23:50" />
                            <DetailBlock label="é£›è¡Œæ™‚é–“" value="2 å°æ™‚ 35 åˆ†" />
                        </div>
                    </InfoCard>

                    {/* 2. ä½å®¿ */}
                    <InfoCard title="ä½å®¿è³‡è¨Š" iconName="HOTEL">
                        
                        {/* ä½å®¿ 1 */}
                        <div className="p-4 bg-custom-light-accent/50 rounded-lg border-l-4 border-custom-accent/90">
                            <h5 className="font-serif-title font-bold text-lg text-custom-dark-text mb-3">ç¬¬ä¸€é–“ä½å®¿</h5>
                            <DetailBlock label="å…¥ä½ / é€€æˆ¿" value="12 æœˆ 4 æ—¥ - 12 æœˆ 5 æ—¥" type="date" />
                            <DetailBlock label="åœ°å€" value="Aewol Coastal-ro 21104" />
                        </div>

                        {/* ä½å®¿ 2 */}
                        <div className="p-4 bg-custom-light-accent/50 rounded-lg border-l-4 border-custom-accent/90">
                            <h5 className="font-serif-title font-bold text-lg text-custom-dark-text mb-3">ç¬¬äºŒé–“ä½å®¿ (Heyy Seogwipo Hotel)</h5>
                            <DetailBlock label="å…¥ä½ / é€€æˆ¿" value="12 æœˆ 5 æ—¥ - 12 æœˆ 6 æ—¥" type="date" />
                            <DetailBlock label="å°èˆªé€£çµ" value="Naveråœ°åœ–é€£çµ" link="https://map.naver.com/p/entry/place/1639869302?c=17.61,0,0,0,dh&placePath=/home?from=map&fromPanelNum=1&additionalHeight=76&timestamp=202511262236&locale=ko&svcName=map_pcv5&businessCategory=hotel" />
                        </div>

                        {/* ä½å®¿ 3 */}
                        <div className="p-4 bg-custom-light-accent/50 rounded-lg border-l-4 border-custom-accent/90">
                            <h5 className="font-serif-title font-bold text-lg text-custom-dark-text mb-3">ç¬¬ä¸‰é–“ä½å®¿ (æ¿Ÿå·æ©Ÿå ´-Urbanstay)</h5>
                            <DetailBlock label="å…¥ä½ / é€€æˆ¿" value="12 æœˆ 6 æ—¥ - 12 æœˆ 8 æ—¥ (2æ™š)" type="date" />
                            <DetailBlock label="å°èˆªé€£çµ" value="Naveråœ°åœ–é€£çµ" link="https://naver.me/5S9zc50f" />
                        </div>
                    </InfoCard>

                    {/* 3. å–è»Šè³‡è¨Š */}
                    <InfoCard title="å–è»Š/é‚„è»Šè³‡è¨Š" iconName="CAR">
                        <DetailBlock label="è¨‚å–®ç·¨è™Ÿ" value="1359039416311386" type="text" />
                        <DetailBlock label="ç§Ÿå€ŸæœŸé–“" value="12/4 07:00 è‡³ 12/8 20:00 (å…±äº”å¤©)" />
                        <DetailBlock label="åœ°é»" value="Jeju AutoHouse" link="https://map.naver.com/p/search/Jeju%20AutoHouse" />
                        <DetailBlock label="äº¤é€šæ–¹å¼" value="æœ‰æ¥é§è»Š" />
                    </InfoCard>

                    {/* 4. å¿…å¸¶ç‰©å“ (æ¸…å–®) */}
                    <InfoCard title="å¿…å¸¶ç‰©å“æ¸…å–®" iconName="BACKPACK">
                        <div className="grid grid-cols-2 md:grid-cols-3 gap-y-3">
                            {['è­·ç…§', 'å°ç£é§•ç…§', 'åœ‹éš›é§•ç…§', 'å°å¹£', 'ä¿¡ç”¨å¡(å»ºè­°å…©å¼µ)', 'è½‰æ¥é ­', 'æ‰‹æ©Ÿ', 'æ›æ´—è¡£ç‰©', 'æ‹–é‹', 'å¸ƒé‹', 'ç›¥æ´—ç”¨å“(ç‰™åˆ·ç‰™è†)', 'å¸¸å‚™è—¥', 'é›¨å…·', '3Cç”¨å“', 'ç”Ÿç†ç”¨å“'].map((item, index) => (
                                <div key={index} className="flex items-center text-custom-dark-text font-content font-light">
                                    <span className="text-custom-accent mr-2 text-xl">ãƒ»</span> {item}
                                </div>
                            ))}
                        </div>
                    </InfoCard>
                    
                    {/* 5. ç©¿æ­æŒ‡å— */}
                    <InfoCard title="å†¬å­£ç©¿æ­æŒ‡å—" iconName="JACKET">
                        <p className="font-content font-medium text-custom-dark-text">æº«åº¦é ä¼°: 5Â°C - 13Â°C (æµ·é¢¨å¼·å‹)</p>
                        <p className="text-custom-accent font-content font-bold border-l-4 border-custom-accent pl-2 mt-2">åŸå‰‡ï¼šæ´‹è”¥å¼ç©¿æ³•ï¼ˆé˜²é¢¨ã€ä¿æš–ã€æ˜“ç©¿è„«ï¼‰</p>
                        <ul className="list-none space-y-2 mt-4">
                            <li className="font-content">
                                <span className="font-bold text-custom-dark-text">å¤–å±¤ (é˜²é¢¨æ˜¯é—œéµ)ï¼š</span> é˜²é¢¨åšå¤–å¥—æˆ–é•·ç‰ˆç¾½çµ¨è¡£ã€‚
                            </li>
                            <li className="font-content">
                                <span className="font-bold text-custom-dark-text">å…§å±¤ï¼š</span> ç™¼ç†±è¡£ã€ä¿æš–å…§è¡£å¿…å‚™ã€‚
                            </li>
                            <li className="font-content">
                                <span className="font-bold text-custom-dark-text">é…ä»¶ (é‡è¦)ï¼š</span> æ¯›å¸½ï¼ˆé˜²é¢¨å¹é ­ç—›ï¼‰ã€åœå·¾ã€æ‰‹å¥—ã€‚
                            </li>
                        </ul>
                    </InfoCard>
                </div>
            );
        };

        // --- Tab 3: çˆ¬å±±è³‡è¨Š (HikingInfoTab) ---
        const HikingInfoTab = () => {
            const DetailBlock = ({ label, value, iconName }) => (
                <div className="flex items-center space-x-2 p-3 bg-custom-light-accent/50 rounded-lg border border-custom-light-accent/80">
                    <img src={getIconUrl(iconName, 'sm')} alt={`${label} Icon`} className="h-5 w-5 opacity-70" />
                    <p className="text-base font-content font-light">
                        <span className="font-medium text-custom-primary/80 mr-1">{label}:</span>
                        <span className="font-bold text-custom-dark-text">{value}</span>
                    </p>
                </div>
            );

            const PointList = ({ title, items, colorClass }) => (
                <div className="mt-8">
                    {/* æ¨™é¡Œ - Noto Serif TC æ¥µç²— */}
                    <h5 className={`text-2xl font-serif-title font-extrabold ${colorClass} mb-4 border-l-4 border-current pl-3`}>{title}</h5>
                    <ul className="list-none space-y-3 ml-2 text-base font-content font-light text-gray-700">
                        {items.map((item, index) => (
                            <li key={index} className="leading-relaxed flex items-start">
                                <span className="text-custom-accent mr-2 text-xl">ãƒ»</span>
                                <span>
                                    <span className="font-bold text-custom-dark-text">{item.split('ï¼š')[0]}ï¼š</span>
                                    {item.split('ï¼š').slice(1).join('ï¼š')}
                                </span>
                            </li>
                        ))}
                    </ul>
                </div>
            );

            return (
                <div className="bg-white rounded-2xl shadow-xl overflow-hidden p-6 mb-10 card-shadow">
                    {/* ä¸»æ¨™é¡Œ - Noto Serif TC æ¥µç²— */}
                    <h2 className="text-4xl font-serif-title font-extrabold text-custom-dark-text border-b border-custom-accent/50 pb-3 mb-6">
                        <img src={getIconUrl('HIKE', 'lg')} alt="Hiking Icon" className="h-8 w-8 inline-block mr-3 opacity-80" />
                        æ¼¢æ‹å±±ç™»å±±æ”»ç•¥
                    </h2>
                    
                    {/* è£å‚™ç§Ÿå€Ÿ */}
                    <div className="p-4 bg-custom-light-accent/50 rounded-xl mb-8 shadow-inner border border-custom-accent/30">
                        <h4 className="text-xl font-serif-title text-custom-dark-text mb-4 flex items-center border-b border-custom-accent/50 pb-2">
                            <img src={getIconUrl('GEAR', 'md')} alt="Gear Icon" className="h-6 w-6 mr-2 opacity-80" />
                            è£å‚™ç§Ÿå€Ÿ (Oshare)
                        </h4>
                        <div className="space-y-3">
                            <DetailBlock label="åº—å®¶ç¶²ç«™" iconName="WEB" value={<a href="https://oshare.kr" target="_blank" rel="noopener noreferrer" className="text-custom-accent hover:underline font-bold font-montserrat-bold">oshare.kr</a>} />
                            <DetailBlock label="å€Ÿç”¨æ™‚é–“" iconName="TIME" value="12/7 19:00 - 12/8 19:00" />
                        </div>
                    </div>

                    {/* è·¯ç·šèˆ‡åŸºæœ¬è³‡è¨Š */}
                    <div className="p-4 bg-custom-light-accent/50 rounded-xl mb-8 shadow-inner border border-custom-accent/30">
                        <h4 className="text-xl font-serif-title text-custom-dark-text mb-4 border-b border-custom-accent/50 pb-2">â„¹ï¸ è·¯ç·šæ¦‚è¦èˆ‡é è¨ˆæ™‚ç¨‹</h4>
                        <div className="space-y-3">
                            <DetailBlock label="è·¯ç·š" iconName="ROUTE" value="å¾¡é‡Œç‰§ä¸Š (ì–´ë¦¬ëª©) éˆå®¤ä¸‹ (ì˜ì‹¤) - éç™»é ‚è·¯ç·š" />
                            <DetailBlock label="ç¸½è·é›¢" iconName="DISTANCE" value="ç´„ 12.6 KM" />
                            <DetailBlock label="é è¨ˆè€—æ™‚" iconName="CLOCK" value="5.5 ~ 6 å°æ™‚" />
                            <DetailBlock label="å±±ä¸Šæ°£æº«" iconName="TEMP" value="0Â°C è‡³ -10Â°C (é«”æ„Ÿæ›´ä½)" />
                        </div>
                    </div>
                    
                    {/* ç©¿æ­æ³¨æ„äº‹é … */}
                    <PointList
                        title="âš ï¸ çˆ¬å±±ç©¿æ­æ³¨æ„äº‹é … (æ´‹è”¥å¼ç©¿æ³•)"
                        colorClass="text-custom-accent"
                        items={[
                            "é ­éƒ¨ï¼šæ¯›å¸½ï¼ˆå¿…å‚™ï¼‰ã€åœè„–ï¼ˆæ¯”åœå·¾å¥½ç”¨ï¼Œä¸æœƒè¢«é¢¨å¹æ•£ï¼‰ã€‚",
                            "å…§å±¤ï¼šæ’æ±—è¡£/ç™¼ç†±è¡£ï¼ˆçµ•å°ä¸è¦ç©¿æ£‰è³ªï¼Œæµæ±—æ¿•äº†æœƒå¤±æº«ï¼‰ã€‚",
                            "ä¸­å±¤ï¼šåˆ·æ¯›è¡£ (Fleece) æˆ–è¼•è–„ç¾½çµ¨èƒŒå¿ƒã€‚",
                            "å¤–å±¤ï¼šé˜²é¢¨é˜²æ°´å¤–å¥— (ç¡¬æ®¼)ï¼Œé€™å±¤æœ€é‡è¦ã€‚",
                            "ä¸‹èº«ï¼šå…§åˆ·æ¯›çš„é˜²é¢¨ç™»å±±è¤²ï¼Œæˆ–é‹å‹•ç·Šèº«è¤² + çŸ­è¤²ã€‚",
                            "é‹å­ï¼šé«˜ç­’é˜²æ°´ç™»å±±é‹æœ€ä½³ï¼ˆä¿è­·è…³è¸ï¼‰ï¼Œæ­é…ç§Ÿå€Ÿå†°çˆªã€‚",
                            "å‚™ç”¨ï¼šèƒŒåŒ…è£¡å¤šæ”¾ä¸€ä»¶åšç¾½çµ¨å¤–å¥—ï¼Œä¼‘æ¯æ™‚ç©¿ã€‚",
                        ]}
                    />

                    {/* è£œçµ¦å“ */}
                    <PointList
                        title="ğŸ è£œçµ¦å“å»ºè­° (ç•¶åœ°è³¼è²·)"
                        colorClass="text-red-500"
                        items={[
                            "é£²ç”¨æ°´ï¼šè‡³å°‘ 1.5 - 2 å…¬å‡ã€‚",
                            "é£Ÿç‰©ï¼šèƒ½é‡æ£’ (é«˜ç†±é‡é£Ÿç‰©)ã€é›»è§£è³ªé‹å‹•é£²æ–™ã€é£¯æ²ã€éºµåŒ…ç­‰ã€‚",
                            "æ³¨æ„ï¼šè·¯ä¸Šé¿é›£æ‰€æ²’æœ‰æä¾›é¤é£Ÿï¼Œå¿…é ˆè‡ªå‚™ï¼",
                        ]}
                    />

                </div>
            );
        };


        // --- æ ¸å¿ƒçµ„ä»¶ï¼šApp ---
        const App = () => {
            const [itinerary, setItinerary] = useState(MOCK_DAILY_ITINERARY);
            const [newLocation, setNewLocation] = useState('');
            const [newDay, setNewDay] = useState(Math.max(1, ...MOCK_DAILY_ITINERARY.map(i => i.day)));
            const [newNotes, setNewNotes] = useState('');
            const [newCategory, setNewCategory] = useState('main');
            const [nextId, setNextId] = useState(Math.max(...MOCK_DAILY_ITINERARY.map(i => i.id)) + 1 || 1);
            const [currentTab, setCurrentTab] = useState('info'); 
            const [liveTime, setLiveTime] = useState(new Date());

            useEffect(() => {
                // ç‚ºäº†é¿å…å•Ÿå‹•å•é¡Œï¼Œé€™è£¡åƒ…åœ¨çµ„ä»¶è¼‰å…¥æ™‚ç²å–ä¸€æ¬¡æ™‚é–“
                setLiveTime(new Date());
            }, []);
            
            const formattedTime = liveTime.toLocaleTimeString('zh-TW', { hour: '2-digit', minute: '2-digit', hour12: false });
            const weather = { location: "æ¿Ÿå·å¸‚", temp: "18Â°C", conditions: "å¤šé›²/é¢¨å¼·", advice: "ä»Šæ—¥æµ·é‚Šé¢¨å¤§ï¼Œå»ºè­°ç©¿è‘—é˜²é¢¨å¤–å¥—ã€‚" };


            // --- è¡Œç¨‹æ“ä½œé‚è¼¯ ---
            
            const sortItinerary = (items) => items.sort((a, b) => {
                if (a.day !== b.day) return a.day - b.day;
                return a.time.localeCompare(b.time);
            });


            const handleAddItem = (e) => {
                e.preventDefault();
                if (!newLocation.trim()) return;

                const newItem = {
                    id: nextId,
                    day: parseInt(newDay),
                    date: `12/${String(newDay).padStart(2, '0')}`,
                    category: newCategory,
                    time: new Date().toLocaleTimeString('zh-TW', { hour: '2-digit', minute: '2-digit', hour12: false }), 
                    location: newLocation.trim(),
                    notes: newNotes.trim(),
                    naverMap: `https://map.naver.com/p/search/${encodeURIComponent(newLocation.trim())}`,
                    searchData: null,
                    officialLink: null,
                };
                
                setItinerary(sortItinerary([...itinerary, newItem]));
                setNextId(nextId + 1);
                
                setNewLocation('');
                setNewNotes('');
                setNewDay(Math.max(1, ...itinerary.map(i => i.day)));
                setNewCategory('main');
            };

            const handleDeleteItem = (id) => {
                setItinerary(itinerary.filter(item => item.id !== id));
            };

            const handleUpdateOrder = (day, newDayItems) => {
                const otherItems = itinerary.filter(item => item.day !== day);
                const updatedItems = [...otherItems, ...newDayItems];
                setItinerary(sortItinerary(updatedItems));
            };
            
            // --- å°éŠæœå°‹åŠŸèƒ½ (ä¸²æ¥ Google Search Tool) ---

            const handleSearchGuide = async (itemId, location) => {
                const userQuery = `æ¿Ÿå·å³¶ ${location} æ™¯é»æ”»ç•¥ æ¨è–¦èœå–®æˆ–éŠç©è³‡è¨Š å®˜æ–¹ç¶²ç«™`;
                
                try {
                    // 1. è¨­ç½®è¼‰å…¥ç‹€æ…‹
                    setItinerary(prev => prev.map(item => 
                        item.id === itemId ? { ...item, searchData: { text: "ğŸ” æ­£åœ¨æœå°‹æ”»ç•¥ä¸­...", title: "è¼‰å…¥ä¸­" } } : item
                    ));
                    
                    // æŒ‡æ•¸é€€é¿é‚è¼¯ (Exponential Backoff)
                    const fetchWithRetry = async (url, options, retries = 3) => {
                        for (let i = 0; i < retries; i++) {
                            try {
                                const response = await fetch(url, options);
                                if (response.ok) return response;
                                // For transient errors (e.g., 500, 429), retry
                                if (response.status >= 500 || response.status === 429) {
                                    const delay = Math.pow(2, i) * 1000 + Math.random() * 1000;
                                    await new Promise(resolve => setTimeout(resolve, delay));
                                    continue;
                                }
                                throw new Error(`HTTP error! status: ${response.status}`);
                            } catch (error) {
                                if (i === retries - 1) throw error;
                                const delay = Math.pow(2, i) * 1000 + Math.random() * 1000;
                                await new Promise(resolve => setTimeout(resolve, delay));
                            }
                        }
                    };

                    const payload = {
                        contents: [{ parts: [{ text: userQuery }] }],
                        tools: [{ "google_search": {} }],
                    };

                    const response = await fetchWithRetry(GEMINI_API_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    
                    const result = await response.json();
                    const candidate = result.candidates?.[0];
                    let fetchedText = "æœªèƒ½æ‰¾åˆ°æœ‰æ•ˆæ”»ç•¥ã€‚";
                    let fetchedTitle = "ç„¡æ•ˆçµæœ";
                    let fetchedUri = null;

                    if (candidate && candidate.content?.parts?.[0]?.text) {
                        fetchedText = candidate.content.parts[0].text;
                        
                        const groundingMetadata = candidate.groundingMetadata;
                        if (groundingMetadata && groundingMetadata.groundingAttributions && groundingMetadata.groundingAttributions.length > 0) {
                            fetchedTitle = groundingMetadata.groundingAttributions[0].web?.title || 'æœå°‹çµæœ';
                            fetchedUri = groundingMetadata.groundingAttributions[0].web?.uri || null;
                        }
                    }
                    
                    // 2. æ›´æ–° state
                    setItinerary(prev => prev.map(item => 
                        item.id === itemId ? { ...item, searchData: { text: fetchedText, title: fetchedTitle, uri: fetchedUri } } : item
                    ));

                } catch (error) {
                    console.error("Guide Search Error:", error);
                    setItinerary(prev => prev.map(item => 
                        item.id === itemId ? { ...item, searchData: { text: "âŒ æœå°‹å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²çµ¡æˆ– API è¨­å®šã€‚", title: "éŒ¯èª¤" } } : item
                    ));
                }
            };

            // --- ä»‹é¢æ¸²æŸ“é‚è¼¯ ---

            const groupedItinerary = useMemo(() => itinerary.reduce((acc, item) => {
                (acc[item.day] = acc[item.day] || []).push(item);
                acc[item.day].sort((a, b) => a.time.localeCompare(b.time));
                return acc;
            }, {}), [itinerary]);

            const days = Object.keys(groupedItinerary).map(Number).sort((a, b) => a - b);
            
            const TabButton = ({ name, label, iconName }) => (
                <button
                    className={`flex items-center justify-center flex-1 px-4 py-4 font-serif-title text-base sm:text-lg font-extrabold transition-all focus:outline-none ${
                        currentTab === name
                            ? 'bg-custom-base text-custom-primary border-b-4 border-custom-accent shadow-inner'
                            : 'text-gray-500 hover:text-custom-primary/80 bg-custom-light-accent/50'
                    }`}
                    onClick={() => setCurrentTab(name)}
                >
                    <img src={getIconUrl(iconName, 'md')} alt={`${label} Icon`} className="h-6 w-6 mr-2 opacity-80" />
                    {label}
                </button>
            );


            return (
                <div className="bg-custom-base min-h-screen">
                    
                    {/* é ‚éƒ¨è³‡è¨Šå€å¡Š - Montserrat æ•¸å­—èˆ‡ Zen Kaku Gothic New å…§æ–‡ */}
                    <div className="sticky top-0 z-10 bg-white shadow-xl p-4 mb-8 rounded-b-2xl border-b-4 border-custom-accent/50 card-shadow">
                        <div className="flex justify-between items-center max-w-5xl mx-auto">
                            {/* ä¸»æ¨™é¡Œ - Noto Serif TC æ¥µç²— */}
                            <h1 className="text-3xl font-serif-title font-extrabold text-custom-dark-text tracking-widest flex items-center">
                                <img src={getIconUrl('LOGO', 'lg')} alt="Palm Logo" className="h-8 w-8 mr-3 opacity-90" />
                                æ¿Ÿå·æ—…ç¨‹
                            </h1>
                            <div className="text-right text-custom-primary">
                                {/* æ™‚é–“ - Montserrat æ¥µç²— */}
                                <p className="text-2xl font-montserrat-bold text-custom-accent">{formattedTime}</p>
                                {/* å¤©æ°£ - Zen Kaku Gothic New ç´°é«” */}
                                <p className="text-sm font-content font-light">{weather.location}: {weather.temp} | {weather.conditions}</p>
                            </div>
                        </div>
                        <p className="text-center text-sm font-content font-light text-custom-primary/80 mt-3 italic border-t border-gray-200 pt-2">{weather.advice}</p>
                    </div>

                    <div className="max-w-5xl mx-auto p-4 sm:p-0">
                        
                        {/* Tab æŒ‰éˆ• - Noto Serif TC æ¥µç²— */}
                        <div className="flex border-b-4 border-custom-light-accent mb-8 bg-custom-light-accent/50 rounded-t-xl overflow-hidden shadow-md">
                            <TabButton name="info" label="é‡è¦è³‡è¨Š" iconName="INFO" />
                            <TabButton name="daily" label="æ¯æ—¥è¡Œç¨‹" iconName="DAILY" />
                            <TabButton name="hiking" label="çˆ¬å±±è³‡è¨Š" iconName="HIKE" />
                        </div>

                        {currentTab === 'info' && <KeyInfoTab FLIGHT_IMAGE_TAIPEI_JEJU={FLIGHT_IMAGE_TAIPEI_JEJU} FLIGHT_IMAGE_JEJU_TAIPEI={FLIGHT_IMAGE_JEJU_TAIPEI} />}
                        
                        {currentTab === 'hiking' && <HikingInfoTab />}

                        {currentTab === 'daily' && (
                            <div className="space-y-10">
                                
                                {/* 1. æ–°å¢è¡Œç¨‹è¡¨å–® (éš±è—/å±•é–‹å¼) */}
                                <div className="border-2 border-custom-accent/70 p-6 rounded-2xl bg-white shadow-xl card-shadow">
                                    <details>
                                        {/* Summary - Noto Serif TC æ¥µç²— */}
                                        <summary className="text-2xl font-serif-title font-extrabold text-custom-dark-text cursor-pointer pb-2 flex items-center">
                                            <img src={getIconUrl('ADD_ITEM', 'md')} alt="Add Icon" className="h-6 w-6 mr-2 text-custom-accent opacity-80" />
                                            å¿«é€Ÿæ–°å¢é …ç›®
                                        </summary>
                                        <form onSubmit={handleAddItem} className="space-y-4 pt-4 border-t border-dashed border-gray-200 mt-2">
                                            <div className="grid grid-cols-1 sm:grid-cols-10 gap-4">
                                                
                                                <label className="flex flex-col sm:col-span-2">
                                                    <span className="text-sm font-content font-light text-custom-primary mb-1">å¤©æ•¸ (Day)</span>
                                                    <input
                                                        type="number"
                                                        min="1"
                                                        value={newDay}
                                                        onChange={(e) => setNewDay(e.target.value)}
                                                        required
                                                        className="p-3 border border-gray-300 rounded-lg focus:ring-custom-accent focus:border-custom-accent transition duration-150 bg-custom-base font-montserrat-bold"
                                                    />
                                                </label>

                                                <label className="flex flex-col sm:col-span-3">
                                                    <span className="text-sm font-content font-light text-custom-primary mb-1">é¡åˆ¥</span>
                                                    <select
                                                        value={newCategory}
                                                        onChange={(e) => setNewCategory(e.target.value)}
                                                        className="p-3 border border-gray-300 rounded-lg focus:ring-custom-accent focus:border-custom-accent transition duration-150 bg-custom-base font-content font-light"
                                                        required
                                                    >
                                                        {Object.keys(CATEGORY_MAP).map(key => (
                                                            <option key={key} value={key}>{CATEGORY_MAP[key].label}</option>
                                                        ))}
                                                    </select>
                                                </label>

                                                <label className="flex flex-col sm:col-span-5">
                                                    <span className="text-sm font-content font-light text-custom-primary mb-1">åœ°é»åç¨± (å¿…å¡«)</span>
                                                    <input
                                                        type="text"
                                                        value={newLocation}
                                                        onChange={(e) => setNewLocation(e.target.value)}
                                                        placeholder="ä¾‹å¦‚ï¼šç‰›å³¶ã€æ¼¢æ‹å±±..."
                                                        required
                                                        className="p-3 border border-gray-300 rounded-lg focus:ring-custom-accent focus:border-custom-accent transition duration-150 bg-custom-base font-content font-light"
                                                    />
                                                </label>
                                            </div>
                                            <label className="flex flex-col">
                                                <span className="text-sm font-content font-light text-custom-primary mb-1">å‚™è¨»/æ´»å‹• (é¸å¡«)</span>
                                                <input
                                                    type="text"
                                                    value={newNotes}
                                                    onChange={(e) => setNewNotes(e.target.value)}
                                                    placeholder="ä¾‹å¦‚ï¼šç§Ÿæ©Ÿè»Šç’°å³¶ã€åˆé¤åƒé»‘è±¬è‚‰"
                                                    className="w-full p-3 border border-gray-300 rounded-lg focus:ring-custom-accent focus:border-custom-accent transition duration-150 bg-custom-base font-content font-light"
                                                />
                                            </label>
                                            <button
                                                type="submit"
                                                className="w-full bg-custom-accent hover:bg-custom-primary text-white font-montserrat-bold py-3 px-4 rounded-xl transition duration-200 shadow-lg hover:shadow-xl transform hover:scale-[1.01] active:scale-[0.99] focus:outline-none focus:ring-4 focus:ring-custom-accent/50"
                                            >
                                                åŠ å…¥è¡Œç¨‹ (ADD)
                                            </button>
                                        </form>
                                    </details>
                                </div>
                                
                                {/* 2. è¡Œç¨‹é¡¯ç¤ºå€åŸŸ */}
                                <div className="space-y-10 scrollable-planner">
                                    <h2 className="text-3xl font-serif-title font-extrabold text-custom-dark-text border-b border-custom-accent/30 pb-3 flex items-center">
                                        <img src={getIconUrl('MAP_TITLE', 'md')} alt="Map Title Icon" className="h-6 w-6 mr-2 opacity-70" />
                                        å®Œæ•´è¡Œç¨‹ç´°ç¯€ ({days.length} å¤©)
                                    </h2>
                                    
                                    {days.length === 0 ? (
                                        <p className="text-custom-primary/70 italic p-6 bg-white rounded-xl text-center shadow-inner font-content">ç›®å‰æ²’æœ‰ä»»ä½•è¡Œç¨‹ï¼Œè«‹åœ¨ä¸Šæ–¹æ–°å¢é …ç›®ã€‚</p>
                                    ) : (
                                        days.map(day => (
                                            <DayPlanner 
                                                key={day} 
                                                day={day} 
                                                dayItems={groupedItinerary[day]} 
                                                onUpdateOrder={handleUpdateOrder}
                                                onSearchGuide={handleSearchGuide}
                                                onDeleteItem={handleDeleteItem}
                                            />
                                        ))
                                    )}
                                </div>
                            </div>
                        )}
                        
                    </div>
                    
                    {/* æ‡¸æµ®æ–°å¢æŒ‰éˆ• (å³ä¸‹è§’ +) */}
                    {currentTab === 'daily' && (
                        <button
                            className="fixed bottom-6 right-6 bg-custom-accent hover:bg-custom-primary text-white p-4 rounded-full shadow-2xl transition duration-300 transform hover:scale-110 active:scale-90 focus:outline-none focus:ring-4 focus:ring-custom-accent/70"
                            onClick={() => {
                                window.scrollTo({ top: 0, behavior: 'smooth' });
                            }}
                            title="å›åˆ°é ‚éƒ¨/å¿«é€Ÿæ–°å¢"
                        >
                            <img src={getIconUrl('ARROW_UP', 'lg')} alt="Scroll Up Icon" className="h-8 w-8 filter brightness-0 invert" />
                        </button>
                    )}
                </div>
            );
        };
        
        // æ¸²æŸ“ App å…ƒä»¶åˆ°é é¢
        document.addEventListener('DOMContentLoaded', () => {
            try {
                const container = document.getElementById('root');
                if (container) {
                    container.innerHTML = ''; 
                    const root = ReactDOM.createRoot(container);
                    root.render(React.createElement(App, null));
                } else {
                    console.error("Fatal Error: Root element '#root' not found.");
                }
            } catch (e) {
                console.error("Fatal Rendering Error:", e);
                const container = document.getElementById('root');
                if (container) {
                    container.innerHTML = `<div class="text-center p-10 text-red-600 font-serif-title">
                        æ‡‰ç”¨ç¨‹å¼å•Ÿå‹•å¤±æ•—ï¼šè«‹æŸ¥çœ‹ä¸»æ§å°éŒ¯èª¤è¨Šæ¯ã€‚
                        <p class="text-sm mt-2">${e.message}</p>
                    </div>`;
                }
            }
        });

    </script>
</body>
</html>
