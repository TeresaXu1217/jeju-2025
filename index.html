import React, { useState, useEffect, useRef } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { 
  MapPin, Clock, ExternalLink, Menu, X, ChevronRight, 
  Wind, Coffee, Mountain, ShoppingBag, Info, Calendar, 
  Plane, Bed, Car, Shirt, Snowflake, Utensils, AlertCircle 
} from 'lucide-react';

// --- 質感日系風格配置 ---
const JapaneseTexture = () => (
  <div className="fixed inset-0 pointer-events-none z-50 opacity-[0.03] mix-blend-multiply" 
       style={{ backgroundImage: `url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E")` }}>
  </div>
);

// --- 資料結構 ---

// 1. 重要資訊
const INFO_DATA = {
  flights: [
    {
      id: 'outbound',
      title: '去程：台北 (TPE) - 濟州 (CJU)',
      date: '12月4日 (週四)',
      time: '02:50 - 06:05',
      duration: '2小時 15分',
      // TODO: 請在此處替換去程機票圖片
      image: 'https://images.unsplash.com/photo-1436491865332-7a61a109cc05?q=80&w=2074&auto=format&fit=crop' 
    },
    {
      id: 'inbound',
      title: '回程：濟州 (CJU) - 台北 (TPE)',
      date: '12月8日 (週一)',
      time: '22:15 - 23:50',
      duration: '2小時 35分',
      // TODO: 請在此處替換回程機票圖片
      image: 'https://images.unsplash.com/photo-1569154941061-e231b4725ef1?q=80&w=2070&auto=format&fit=crop'
    }
  ],
  hotels: [
    {
      name: '第一晚住宿',
      engName: 'Jeju West Coast Stay',
      checkIn: '12/04 16:00後',
      checkOut: '12/05 11:00前',
      address: 'Jeju Island Jeju-si Aewol Coastal-ro 21104',
      nights: 1,
      link: 'https://map.naver.com'
    },
    {
      name: 'Heyy Seogwipo Hotel',
      engName: 'Heyy Seogwipo',
      checkIn: '12/05 16:00後',
      checkOut: '12/06 11:00前',
      address: '西歸浦市區',
      nights: 1,
      link: 'https://map.naver.com/p/entry/place/1639869302'
    },
    {
      name: 'Urbanstay Jeju',
      engName: 'Urbanstay Jeju City',
      checkIn: '12/06 16:00後',
      checkOut: '12/08 11:00前',
      address: '濟州市區',
      nights: 2,
      link: 'https://naver.me/5S9zc50f'
    }
  ],
  carRental: {
    orderId: '1359039416311386',
    period: '12/04 07:00 - 12/08 20:00 (共五天)',
    location: 'Jeju AutoHouse',
    address: '92 Yonghae-ro, Jeju-do',
    transport: '有接駁車',
    items: ['護照', '台灣駕照', '國際駕照', '信用卡(建議兩張)']
  },
  packing: [
    '護照', '駕照(台/國際)', '台幣/信用卡', '轉接頭', '手機/3C',
    '換洗衣物', '拖鞋/布鞋', '牙刷牙膏', '常備藥', '雨具', '生理用品'
  ],
  clothing: {
    temp: '5°C - 13°C (體感更低)',
    tips: '海風強勁，雖然不像首爾凍，但濕冷感重。',
    layers: [
      { part: '外層', item: '防風厚外套/長版羽絨', note: '一般毛呢大衣不防風會很冷' },
      { part: '中層', item: '毛衣、厚衛衣 (大學T)', note: '舒適保暖' },
      { part: '內層', item: '發熱衣、保暖內衣', note: '必備' },
      { part: '下身', item: '內刷毛長褲/厚褲襪', note: '保暖為主' },
      { part: '配件', item: '毛帽、圍巾、手套', note: '防風吹頭痛' }
    ]
  }
};

// 2. 爬山資訊
const HIKING_DATA = {
  rental: {
    shop: 'Oshare (裝備店)',
    link: 'https://oshare.kr',
    time: '12/7 19:00 - 12/8 19:00',
    note: '請務必準時歸還'
  },
  route: {
    name: '漢拏山 (御里牧上 - 靈室下)',
    desc: '非登頂路線，風景優美且相對簡單。',
    distance: '12.6 KM',
    duration: '5.5 ~ 6 小時',
    temp: '0°C 至 -10°C (體感極低)'
  },
  gear: [
    { item: '頭部', desc: '毛帽 (必備)、圍脖 (比圍巾好用，不會被風吹散)' },
    { item: '上身內層', desc: '排汗衣/發熱衣 (絕對不要穿棉質)' },
    { item: '上身中層', desc: '刷毛衣 (Fleece) 或輕薄羽絨背心' },
    { item: '上身外層', desc: '防風防水外套 (硬殼) - 最重要！擋風！' },
    { item: '下身', desc: '內刷毛防風登山褲 或 運動緊身褲+短褲' },
    { item: '足部', desc: '厚羊毛襪 (建議多備一雙)、高筒防水登山鞋、冰爪' },
    { item: '補給品', desc: '水(1.5-2L)、能量棒、飯捲、麵包 (避難所無餐食)' }
  ]
};

// 3. 每日行程 (分為 Route, Food, Cafe, Backup)
const SCHEDULE_DATA = {
  day1: {
    id: 'day1', date: '12/04', title: '抵達 + Aewol 西岸放鬆',
    banner: 'https://images.unsplash.com/photo-1548115184-bc6544d06a58?q=80&w=2070&auto=format&fit=crop',
    route: [
      { time: '06:05', title: '抵達', place: '濟州國際機場', note: '出關領行李', link: 'https://map.naver.com' },
      { time: '07:00', title: '租車', place: 'LOTTE Rent-a-Car', note: '搭乘接駁車前往', link: 'https://map.naver.com' },
      { time: '08:30', title: '咖啡放鬆', place: 'Bomnal Café', note: '著名的海景咖啡，早晨光線美', link: 'https://map.naver.com' },
      { time: '10:30', title: '散步拍照', place: '協載海灘', note: '海水顏色最美的海灘', link: 'https://map.naver.com' },
      { time: '12:30', title: '午餐', place: 'Aewol 附近', note: '見下方美食推薦', link: '' },
      { time: '20:00', title: '入住', place: '第一晚住宿', note: '記得確認 Check-in 方式', link: '' },
    ],
    food: [
      { name: 'Nolman 海鮮拉麵', desc: '新鮮海鮮，湯頭鮮甜', link: 'https://map.naver.com' },
      { name: 'Crab Jack', desc: '手抓海鮮，適合多人', link: 'https://map.naver.com' },
    ],
    cafe: [
      { name: 'Cafe Knotted', desc: '甜甜圈名店，需排隊', link: 'https://map.naver.com' },
      { name: 'Tribe', desc: '舒芙蕾鬆餅，氛圍可愛', link: 'https://map.naver.com' },
    ],
    backup: [
      { name: 'Glass House', desc: '若時間允許，建築攝影迷必去', link: 'https://map.naver.com' },
      { name: 'Arte Museum', desc: '雨天首選，沉浸式光影藝術', link: 'https://map.naver.com' },
    ]
  },
  day2: {
    id: 'day2', date: '12/05', title: '9.81 Park → 綠茶 → 西歸浦',
    banner: 'https://images.unsplash.com/photo-1570535384203-999990818c39?q=80&w=2046&auto=format&fit=crop',
    route: [
      { time: '09:00', title: '前往', place: '9.81 Park', note: '準備好玩賽車', link: 'https://map.naver.com' },
      { time: '09:30', title: '遊玩', place: '9.81 Park', note: '建議停留 3 小時', link: 'https://map.naver.com' },
      { time: '12:40', title: '午餐', place: '濟州堂', note: '大型烘焙咖啡廳', link: 'https://map.naver.com' },
      { time: '15:00', title: '觀光', place: 'O’Sulloc 綠茶博物館', note: '必吃綠茶冰淇淋', link: 'https://map.naver.com' },
      { time: '17:30', title: '入住', place: 'Heyy Seogwipo', note: '西歸浦市區', link: 'https://map.naver.com' },
      { time: '18:00', title: '晚餐', place: '每日偶來市場', note: '體驗夜市小吃', link: 'https://map.naver.com' },
    ],
    food: [
      { name: '偶來市場 橘子麻糬', desc: '排隊名產', link: '' },
      { name: '炸黑豬肉捲', desc: '市場必吃', link: '' },
    ],
    cafe: [
      { name: 'Innisfree House', desc: '就在綠茶博物館旁，可做肥皂DIY', link: 'https://map.naver.com' },
    ],
    backup: [
      { name: '大浦柱狀節理帶', desc: '鬼斧神工的岩壁，需好天氣', link: 'https://map.naver.com' },
    ]
  },
  day3: {
    id: 'day3', date: '12/06', title: '牛島 + 城山日出峰',
    banner: 'https://images.unsplash.com/photo-1549887552-93f8efb4133f?q=80&w=2070&auto=format&fit=crop',
    route: [
      { time: '08:00', title: '出發', place: '城山港', note: '準備搭船', link: 'https://map.naver.com' },
      { time: '10:00', title: '渡輪', place: '前往牛島', note: '記得帶護照買船票', link: 'https://map.naver.com' },
      { time: '10:20', title: '環島', place: '牛島 Udo', note: '租電動車環島', link: 'https://map.naver.com' },
      { time: '16:00', title: '景點', place: '城山日出峰', note: '看壯觀火山口', link: 'https://map.naver.com' },
      { time: '18:20', title: '領裝備', place: 'Oshare', note: '為明天爬山做準備', link: 'https://map.naver.com' },
      { time: '19:10', title: '入住', place: 'Urbanstay Jeju', note: '市區飯店', link: 'https://map.naver.com' },
    ],
    food: [
      { name: '牛島花生冰淇淋', desc: '島上必吃', link: '' },
      { name: '漢拿山炒飯', desc: '造型可愛的炒飯', link: '' },
    ],
    cafe: [
      { name: 'Blanc Rocher', desc: '牛島最美海景咖啡', link: 'https://map.naver.com' },
    ],
    backup: [
      { name: '涉地可支', desc: '海岸散步，適合看日落', link: 'https://map.naver.com' },
    ]
  },
  day4: {
    id: 'day4', date: '12/07', title: '漢拏山健行',
    banner: 'https://images.unsplash.com/photo-1610368307274-12349899321e?q=80&w=2070&auto=format&fit=crop',
    route: [
      { time: '07:00', title: '移動', place: '前往御里牧', note: '車程約 30-40 分', link: 'https://map.naver.com' },
      { time: '07:30', title: '登山', place: '開始爬山', note: '穿上冰爪，注意保暖', link: 'https://map.naver.com' },
      { time: '全天', title: '健行', place: '御里牧 - 靈室', note: '享受雪景與挑戰', link: '' },
      { time: '傍晚', title: '下山', place: '靈室登山口', note: '搭計程車或公車回停車場', link: '' },
      { time: '晚上', title: '休息', place: '市區晚餐', note: '大吃一頓黑豬肉', link: '' },
    ],
    food: [
      { name: '黑豚家', desc: '正宗濟州黑豬肉燒烤', link: 'https://map.naver.com' },
      { name: '校村炸雞', desc: '外送回飯店吃', link: 'https://map.naver.com' },
    ],
    cafe: [],
    backup: [
      { name: '1100高地', desc: '若不爬山，可開車到此看雪', link: 'https://map.naver.com' },
    ]
  },
  day5: {
    id: 'day5', date: '12/08', title: '採買 & 返程',
    banner: 'https://images.unsplash.com/photo-1535189043414-47a3c49a0bed?q=80&w=2070&auto=format&fit=crop',
    route: [
      { time: '早上', title: '採買', place: '東門傳統市場', note: '買橘子巧克力、伴手禮', link: 'https://map.naver.com' },
      { time: '下午', title: '彈性', place: '補齊未去景點', note: '海邊咖啡發呆', link: '' },
      { time: '19:00', title: '歸還', place: 'Oshare 裝備', note: '檢查裝備無損壞', link: 'https://map.naver.com' },
      { time: '20:00', title: '還車', place: 'LOTTE Rent-a-Car', note: '預留時間接駁', link: 'https://map.naver.com' },
      { time: '22:15', title: '飛機', place: '返回台北', note: '再見濟州', link: '' },
    ],
    food: [
      { name: '東門市場小吃', desc: '糖餅、魚板', link: '' },
      { name: '真情鮑魚海鮮砂鍋', desc: '機場附近美食', link: 'https://map.naver.com' },
    ],
    cafe: [
      { name: 'Cafe Layered', desc: '漂亮的司康與蛋糕', link: 'https://map.naver.com' },
    ],
    backup: []
  }
};

export default function App() {
  const [activeCategory, setActiveCategory] = useState('home'); // home, info, schedule, hiking
  const [activeDay, setActiveDay] = useState('day1');
  const [isMenuOpen, setIsMenuOpen] = useState(false);

  const handleNav = (category, day = null) => {
    setActiveCategory(category);
    if (day) setActiveDay(day);
    setIsMenuOpen(false);
    window.scrollTo({ top: 0, behavior: 'smooth' });
  };

  return (
    <div className="min-h-screen bg-[#F5F4F0] text-[#4A4843] font-sans selection:bg-[#D4D1C9] selection:text-[#2C2C2C]">
      {/* 字體 */}
      <style>{`
        @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@300;500;700&family=Zen+Maru+Gothic:wght@300;400;500&display=swap');
        body { font-family: 'Zen Maru Gothic', sans-serif; }
        .serif-font { font-family: 'Noto Serif TC', serif; }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
      `}</style>
      
      <JapaneseTexture />

      {/* Navigation */}
      <nav className="fixed top-0 left-0 right-0 z-50 bg-[#F5F4F0]/95 backdrop-blur-md border-b border-[#E6E4DD] h-16 flex items-center justify-between px-6">
        <div className="text-xl tracking-widest serif-font cursor-pointer font-bold text-[#2C2C2C]" onClick={() => handleNav('home')}>
          JEJU 2025
        </div>

        {/* Desktop Menu */}
        <div className="hidden md:flex space-x-10 text-sm tracking-widest font-medium text-[#888]">
          {['INFO', 'SCHEDULE', 'HIKING'].map((item) => (
            <button 
              key={item}
              onClick={() => handleNav(item.toLowerCase())}
              className={`hover:text-[#2C2C2C] transition-colors relative pb-1 ${activeCategory === item.toLowerCase() ? 'text-[#2C2C2C]' : ''}`}
            >
              {item === 'INFO' ? '重要資訊' : item === 'SCHEDULE' ? '每日行程' : '爬山資訊'}
              {activeCategory === item.toLowerCase() && (
                <motion.div layoutId="nav-underline" className="absolute bottom-0 left-0 right-0 h-[1px] bg-[#2C2C2C]" />
              )}
            </button>
          ))}
        </div>

        {/* Mobile Menu Toggle */}
        <button className="md:hidden text-[#2C2C2C]" onClick={() => setIsMenuOpen(!isMenuOpen)}>
          {isMenuOpen ? <X size={24} /> : <Menu size={24} />}
        </button>
      </nav>

      {/* Mobile Menu Overlay */}
      <AnimatePresence>
        {isMenuOpen && (
          <motion.div 
            initial={{ opacity: 0, y: -20 }} animate={{ opacity: 1, y: 0 }} exit={{ opacity: 0, y: -20 }}
            className="fixed inset-0 z-40 bg-[#F5F4F0] pt-24 px-8 flex flex-col space-y-8"
          >
            {[
              { id: 'home', label: 'Home 首頁' },
              { id: 'info', label: 'Info 重要資訊' },
              { id: 'schedule', label: 'Schedule 每日行程' },
              { id: 'hiking', label: 'Hiking 爬山資訊' }
            ].map((item) => (
              <button 
                key={item.id}
                onClick={() => handleNav(item.id)}
                className="text-2xl serif-font text-left text-[#666] flex justify-between items-center border-b border-[#E6E4DD] pb-4"
              >
                <span>{item.label}</span>
                <ChevronRight size={20} />
              </button>
            ))}
          </motion.div>
        )}
      </AnimatePresence>

      {/* Main Content */}
      <main className="relative z-10 pt-16">
        {activeCategory === 'home' && <HomeView onNavigate={handleNav} />}
        {activeCategory === 'info' && <InfoView data={INFO_DATA} />}
        {activeCategory === 'schedule' && (
          <ScheduleView 
            schedule={SCHEDULE_DATA} 
            activeDay={activeDay} 
            onDayChange={setActiveDay} 
          />
        )}
        {activeCategory === 'hiking' && <HikingView data={HIKING_DATA} />}
      </main>

      {/* Footer */}
      <footer className="py-12 text-center text-[#999] text-xs tracking-[0.2em] border-t border-[#E6E4DD] mt-20 bg-[#F5F4F0]">
        <p>JEJU TRIP 2025 • WINTER EDITION</p>
      </footer>
    </div>
  );
}

// --- Views Components ---

// 1. Home View
function HomeView({ onNavigate }) {
  return (
    <motion.div initial={{ opacity: 0 }} animate={{ opacity: 1 }} className="w-full">
      <div className="relative w-full h-[90vh] overflow-hidden">
        <div className="absolute inset-0 bg-black/20 z-10" />
        <img 
          src="https://images.unsplash.com/photo-1528629297340-d1d466945dc5?q=80&w=2244&auto=format&fit=crop" 
          alt="Jeju Hero" 
          className="w-full h-full object-cover animate-pan-slow"
        />
        <div className="absolute inset-0 z-20 flex flex-col items-center justify-center text-white text-center px-4">
          <motion.div initial={{ y: 30, opacity: 0 }} animate={{ y: 0, opacity: 1 }} transition={{ delay: 0.3, duration: 0.8 }}>
            <h2 className="text-sm tracking-[0.3em] mb-6 uppercase">December 4 - 8, 2025</h2>
            <h1 className="text-6xl md:text-8xl serif-font font-thin mb-8 tracking-widest">
              濟州島
            </h1>
            <p className="max-w-md mx-auto text-sm leading-loose opacity-90 font-light tracking-wide border-l border-white/50 pl-6 text-left">
              從西岸的海風到漢拏山的雪白。<br/>
              這是一段關於自然、咖啡與自我的對話。
            </p>
          </motion.div>
          
          <motion.button 
            initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 1 }}
            onClick={() => onNavigate('schedule')}
            className="mt-16 px-8 py-3 border border-white/30 hover:bg-white hover:text-black transition-all text-sm tracking-[0.2em] backdrop-blur-sm"
          >
            VIEW ITINERARY
          </motion.button>
        </div>
      </div>
    </motion.div>
  );
}

// 2. Info View (重要資訊)
function InfoView({ data }) {
  return (
    <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="max-w-4xl mx-auto px-6 py-12 space-y-20">
      
      {/* Header */}
      <div className="text-center space-y-4">
        <h2 className="text-3xl serif-font text-[#2C2C2C]">Trip Essentials</h2>
        <p className="text-[#888] tracking-widest text-sm">重要資訊 • 航班 • 住宿 • 穿搭</p>
      </div>

      {/* Flights */}
      <section>
        <SectionTitle icon={<Plane size={20} />} title="航班資訊 Flights" />
        <div className="grid md:grid-cols-2 gap-8 mt-6">
          {data.flights.map((flight) => (
            <div key={flight.id} className="bg-white p-6 rounded shadow-sm border border-[#E6E4DD] group">
              <div className="mb-4 aspect-video bg-[#F0F0F0] overflow-hidden rounded relative">
                <img src={flight.image} alt="Flight" className="w-full h-full object-cover group-hover:scale-105 transition-transform duration-700" />
                <div className="absolute inset-0 flex items-center justify-center bg-black/10 text-white text-xs opacity-0 group-hover:opacity-100 transition-opacity">
                   機票截圖
                </div>
              </div>
              <h3 className="font-bold text-[#444] mb-2">{flight.title}</h3>
              <div className="space-y-1 text-sm text-[#666]">
                <p className="flex items-center"><Calendar size={14} className="mr-2"/> {flight.date}</p>
                <p className="flex items-center"><Clock size={14} className="mr-2"/> {flight.time} ({flight.duration})</p>
              </div>
            </div>
          ))}
        </div>
      </section>

      {/* Accommodation */}
      <section>
        <SectionTitle icon={<Bed size={20} />} title="住宿 Accommodation" />
        <div className="space-y-6 mt-6">
          {data.hotels.map((hotel, idx) => (
            <div key={idx} className="bg-white p-6 md:p-8 rounded shadow-sm border border-[#E6E4DD] flex flex-col md:flex-row justify-between gap-6">
              <div className="flex-1">
                <div className="flex items-baseline space-x-3 mb-1">
                  <h3 className="text-xl serif-font text-[#2C2C2C]">{hotel.name}</h3>
                  <span className="text-xs bg-[#F5F4F0] px-2 py-0.5 rounded text-[#888]">{hotel.nights}晚</span>
                </div>
                <p className="text-sm text-[#999] mb-4">{hotel.engName}</p>
                <div className="space-y-2 text-sm text-[#666]">
                  <p><strong>Check-in:</strong> {hotel.checkIn}</p>
                  <p><strong>Check-out:</strong> {hotel.checkOut}</p>
                  <p className="text-[#888] text-xs mt-2">{hotel.address}</p>
                </div>
              </div>
              <div className="flex flex-col justify-end">
                <a href={hotel.link} target="_blank" rel="noreferrer" className="flex items-center justify-center space-x-2 px-6 py-3 bg-[#2C2C2C] text-white text-xs tracking-widest hover:bg-[#444] transition-colors rounded-sm">
                  <span>VIEW MAP</span> <ExternalLink size={14} />
                </a>
              </div>
            </div>
          ))}
        </div>
      </section>

      {/* Car Rental */}
      <section>
        <SectionTitle icon={<Car size={20} />} title="租車資訊 Car Rental" />
        <div className="bg-[#FAF9F6] p-8 rounded border border-[#E6E4DD] mt-6 relative overflow-hidden">
          <div className="absolute top-0 right-0 p-4 opacity-10"><Car size={120} /></div>
          <div className="relative z-10 space-y-4">
             <div>
               <p className="text-xs text-[#888] tracking-widest uppercase">Order ID</p>
               <p className="text-2xl serif-font tracking-wide">{data.carRental.orderId}</p>
             </div>
             <div className="grid md:grid-cols-2 gap-6 pt-4">
               <div>
                 <p className="font-bold text-[#444] mb-1">租借期間</p>
                 <p className="text-sm text-[#666]">{data.carRental.period}</p>
               </div>
               <div>
                 <p className="font-bold text-[#444] mb-1">地點 ({data.carRental.transport})</p>
                 <p className="text-sm text-[#666]">{data.carRental.location}</p>
                 <p className="text-xs text-[#999]">{data.carRental.address}</p>
               </div>
             </div>
             <div className="pt-4 border-t border-[#E6E4DD]">
               <p className="text-xs font-bold text-[#888] mb-2">取車必備</p>
               <div className="flex flex-wrap gap-2">
                 {data.carRental.items.map(i => (
                   <span key={i} className="text-xs bg-white border border-[#DDD] px-2 py-1 rounded text-[#555]">{i}</span>
                 ))}
               </div>
             </div>
          </div>
        </div>
      </section>

      {/* Clothing & Packing */}
      <section className="grid md:grid-cols-2 gap-12">
        <div>
          <SectionTitle icon={<Shirt size={20} />} title="穿搭建議 Weather & Wear" />
          <div className="mt-6 space-y-6">
            <div className="bg-[#E3F2FD]/50 p-4 rounded border border-[#BBDEFB]/50 flex items-start space-x-3">
              <Snowflake className="text-[#64B5F6] mt-1 flex-shrink-0" size={20} />
              <div className="text-sm text-[#555]">
                <p className="font-bold mb-1">氣溫 {data.clothing.temp}</p>
                <p>{data.clothing.tips}</p>
              </div>
            </div>
            <div className="space-y-3">
              <p className="text-xs text-[#888] tracking-widest text-center uppercase mb-4">- 洋蔥式穿搭指南 -</p>
              {data.clothing.layers.map((l, i) => (
                <div key={i} className="flex items-center text-sm border-b border-[#EEE] pb-2 last:border-0">
                  <span className="w-16 font-bold text-[#AA9988] text-xs uppercase">{l.part}</span>
                  <div className="flex-1">
                    <span className="text-[#444]">{l.item}</span>
                    <p className="text-[10px] text-[#999]">{l.note}</p>
                  </div>
                </div>
              ))}
            </div>
          </div>
        </div>

        <div>
           <SectionTitle icon={<ShoppingBag size={20} />} title="必帶物品 Checklist" />
           <div className="mt-6 grid grid-cols-2 gap-3">
             {data.packing.map((item, i) => (
               <div key={i} className="flex items-center space-x-2 text-sm text-[#555]">
                 <div className="w-4 h-4 rounded border border-[#CCC]" />
                 <span>{item}</span>
               </div>
             ))}
           </div>
        </div>
      </section>
    </motion.div>
  );
}

// 3. Hiking View (爬山資訊)
function HikingView({ data }) {
  return (
    <motion.div initial={{ opacity: 0 }} animate={{ opacity: 1 }} className="max-w-4xl mx-auto px-6 py-12">
      <div className="relative rounded-xl overflow-hidden mb-12 h-64 md:h-80 shadow-lg">
        <img src="https://images.unsplash.com/photo-1454496522488-7a8e488e8606?q=80&w=2076&auto=format&fit=crop" alt="Hallasan" className="w-full h-full object-cover" />
        <div className="absolute inset-0 bg-black/40 flex items-center justify-center flex-col text-white">
          <h1 className="text-4xl serif-font mb-2">Hallasan Hiking</h1>
          <p className="tracking-widest text-sm opacity-90">漢拏山 • 雪地健行攻略</p>
        </div>
      </div>

      <div className="grid md:grid-cols-3 gap-8">
        {/* Main Info */}
        <div className="md:col-span-2 space-y-12">
          <section>
            <h3 className="text-xl serif-font text-[#2C2C2C] mb-4 flex items-center"><MapPin className="mr-2" size={18} /> 路線資訊</h3>
            <div className="bg-white p-6 rounded border border-[#E6E4DD] space-y-4">
              <div className="flex justify-between items-start border-b border-[#F0F0F0] pb-4">
                <div>
                   <h4 className="font-bold text-lg text-[#2C2C2C]">{data.route.name}</h4>
                   <p className="text-sm text-[#666] mt-1">{data.route.desc}</p>
                </div>
                <div className="text-right">
                  <span className="block text-2xl font-light text-[#2C6E49]">{data.route.distance}</span>
                  <span className="text-xs text-[#888]">總距離</span>
                </div>
              </div>
              <div className="grid grid-cols-2 gap-4 text-sm">
                <div>
                  <span className="block text-[#888] text-xs mb-1">預計耗時</span>
                  <span className="font-medium text-[#444]">{data.route.duration}</span>
                </div>
                <div>
                  <span className="block text-[#888] text-xs mb-1">預計氣溫</span>
                  <span className="font-medium text-[#444]">{data.route.temp}</span>
                </div>
              </div>
            </div>
          </section>

          <section>
            <h3 className="text-xl serif-font text-[#2C2C2C] mb-4 flex items-center"><AlertCircle className="mr-2" size={18} /> 裝備指南</h3>
            <div className="space-y-4">
              {data.gear.map((g, i) => (
                <div key={i} className="flex bg-[#FAF9F6] p-4 rounded border border-[#E6E4DD]">
                  <div className="w-24 flex-shrink-0 font-bold text-[#888] text-sm uppercase">{g.item}</div>
                  <div className="text-sm text-[#444] leading-relaxed">{g.desc}</div>
                </div>
              ))}
            </div>
          </section>
        </div>

        {/* Sidebar Info */}
        <div className="space-y-8">
          <div className="bg-[#2C2C2C] text-[#F5F4F0] p-6 rounded shadow-lg">
            <h4 className="text-lg serif-font mb-4 border-b border-gray-600 pb-2">裝備租借</h4>
            <p className="font-bold text-xl mb-1">{data.rental.shop}</p>
            <a href={data.rental.link} target="_blank" rel="noreferrer" className="text-xs text-[#AAA] hover:text-white underline mb-6 block">
              {data.rental.link}
            </a>
            
            <div className="space-y-4 text-sm">
              <div>
                <span className="block text-[#888] text-xs mb-1">借用時間</span>
                <p>{data.rental.time}</p>
              </div>
              <div className="p-3 bg-white/10 rounded text-xs text-[#CCC]">
                ⚠️ {data.rental.note}
              </div>
            </div>
          </div>

          <div className="p-6 border border-[#E6E4DD] rounded bg-white">
            <h4 className="font-bold text-[#444] mb-3 text-sm">導遊小撇步</h4>
            <ul className="text-sm text-[#666] space-y-2 list-disc list-inside">
              <li>行動糧食很重要，山上沒有賣吃的。</li>
              <li>保溫瓶裝熱水，山上喝一口熱水是救贖。</li>
              <li>下山比上山滑，注意腳步。</li>
            </ul>
          </div>
        </div>
      </div>
    </motion.div>
  );
}

// 4. Schedule View (每日行程)
function ScheduleView({ schedule, activeDay, onDayChange }) {
  const dayData = schedule[activeDay];

  return (
    <div className="min-h-screen pb-20">
      {/* Day Selector */}
      <div className="sticky top-16 z-30 bg-[#F5F4F0]/95 backdrop-blur border-b border-[#E6E4DD] overflow-x-auto scrollbar-hide">
        <div className="flex justify-start md:justify-center min-w-max px-4">
          {Object.values(schedule).map((day) => (
            <button
              key={day.id}
              onClick={() => onDayChange(day.id)}
              className={`px-6 py-4 text-sm tracking-widest transition-colors border-b-2 ${activeDay === day.id ? 'border-[#2C2C2C] text-[#2C2C2C] font-bold' : 'border-transparent text-[#999] hover:text-[#666]'}`}
            >
              {day.id.toUpperCase().replace('DAY', 'DAY ')}
            </button>
          ))}
        </div>
      </div>

      {/* Banner */}
      <motion.div 
        key={activeDay}
        initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ duration: 0.5 }}
        className="relative h-[40vh] md:h-[50vh] w-full"
      >
        <div className="absolute inset-0 bg-black/20" />
        <img src={dayData.banner} alt="Banner" className="w-full h-full object-cover" />
        <div className="absolute bottom-0 left-0 p-8 md:p-12 text-white bg-gradient-to-t from-black/60 to-transparent w-full">
           <p className="tracking-[0.2em] text-sm mb-2 opacity-80">{dayData.date} • {dayData.id.toUpperCase()}</p>
           <h2 className="text-3xl md:text-5xl serif-font font-light">{dayData.title}</h2>
        </div>
      </motion.div>

      {/* Content Container */}
      <div className="max-w-5xl mx-auto px-4 md:px-8 -mt-8 relative z-10 space-y-12">
        
        {/* Main Route (Vertical Timeline) */}
        <div className="bg-white rounded shadow-xl shadow-[#00000005] border border-[#EBE9E4] overflow-hidden">
          <div className="p-6 border-b border-[#F0F0F0] bg-white/50 sticky top-0">
             <h3 className="text-xs font-bold tracking-[0.2em] text-[#888] uppercase flex items-center">
               <MapPin size={14} className="mr-2"/> Main Route
             </h3>
          </div>
          <div className="divide-y divide-[#F0F0F0]">
            {dayData.route.map((item, idx) => (
              <div key={idx} className="p-6 hover:bg-[#FAF9F6] transition-colors flex gap-6">
                 <div className="w-16 flex-shrink-0 text-right font-medium text-[#2C2C2C] serif-font pt-1">{item.time}</div>
                 <div className="flex-1 border-l-2 border-[#F0F0F0] pl-6 relative">
                   <div className="absolute -left-[7px] top-2 w-3 h-3 rounded-full bg-[#E6E4DD] border-2 border-white" />
                   <h4 className="text-lg font-medium text-[#333]">{item.place}</h4>
                   <p className="text-xs font-bold text-[#AA9988] tracking-wider uppercase mb-1">{item.title}</p>
                   <p className="text-sm text-[#666] font-light mb-2">{item.note}</p>
                   {item.link && (
                     <a href={item.link} target="_blank" rel="noreferrer" className="inline-flex items-center text-xs text-[#888] hover:text-[#2C6E49] transition-colors bg-[#F5F4F0] px-2 py-1 rounded">
                       Naver Map <ExternalLink size={10} className="ml-1"/>
                     </a>
                   )}
                 </div>
              </div>
            ))}
          </div>
        </div>

        {/* Horizontal Sliders for Food/Cafe/Backup */}
        <HorizontalSection title="Nearby Food 美食" icon={<Utensils size={16}/>} items={dayData.food} />
        <HorizontalSection title="Coffee & Dessert 咖啡甜點" icon={<Coffee size={16}/>} items={dayData.cafe} />
        <HorizontalSection title="Backup Plan 備案" icon={<AlertCircle size={16}/>} items={dayData.backup} />

      </div>
    </div>
  );
}

// Helper: Horizontal Scroll Section
function HorizontalSection({ title, icon, items }) {
  if (!items || items.length === 0) return null;
  return (
    <section>
      <h3 className="flex items-center text-sm font-bold tracking-[0.2em] text-[#444] uppercase mb-4 px-2">
        <span className="mr-2 text-[#888]">{icon}</span> {title}
      </h3>
      <div className="flex overflow-x-auto space-x-4 pb-6 px-2 scrollbar-hide snap-x">
        {items.map((item, idx) => (
          <div key={idx} className="flex-shrink-0 w-64 bg-white border border-[#E6E4DD] p-5 rounded snap-center hover:shadow-md transition-shadow">
            <h4 className="font-bold text-[#333] mb-1">{item.name}</h4>
            <p className="text-sm text-[#666] mb-4 h-10 overflow-hidden">{item.desc}</p>
            {item.link ? (
               <a href={item.link} target="_blank" rel="noreferrer" className="text-xs text-[#2C2C2C] border border-[#DDD] px-3 py-1.5 rounded hover:bg-[#2C2C2C] hover:text-white transition-colors block text-center">
                 VIEW MAP
               </a>
            ) : (
               <span className="text-xs text-[#CCC] border border-[#EEE] px-3 py-1.5 rounded block text-center cursor-not-allowed">NO LINK</span>
            )}
          </div>
        ))}
        {/* Spacer for padding right */}
        <div className="w-2 flex-shrink-0" />
      </div>
    </section>
  );
}

// Helper: Section Title
function SectionTitle({ icon, title }) {
  return (
    <div className="flex items-center space-x-3 border-b border-[#E6E4DD] pb-2 mb-4">
      <span className="text-[#2C2C2C]">{icon}</span>
      <h3 className="text-lg serif-font text-[#2C2C2C]">{title}</h3>
    </div>
  );
}
